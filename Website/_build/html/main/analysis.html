
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Analysis &#8212; Walmart Sales Forecasting</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'main/analysis';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Forecasting" href="forecasting.html" />
    <link rel="prev" title="Results and Conclusions" href="../summary/summary.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../home.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo2.png" class="logo__image only-light" alt="Walmart Sales Forecasting - Home"/>
    <script>document.write(`<img src="../_static/logo2.png" class="logo__image only-dark" alt="Walmart Sales Forecasting - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Summary</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../summary/introduction.html">Introduction</a></li>

<li class="toctree-l1"><a class="reference internal" href="../summary/summary.html">Results and Conclusions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Analysis and Forecasting</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="forecasting.html">Forecasting</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../about/about.html">About This Project</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/joshiaditya0511/walmart-sales-forecasting" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/main/analysis.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-libraries-and-dataset">Importing Libraries and Dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preliminary-data-cleaning">Preliminary Data Cleaning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-major-observations">Final/Major Observations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-if-features-vary-only-with-date-or-store-too">Checking if features vary only with date or store too</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cpi">CPI</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature">Temperature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#holidays">Holidays</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions-observations">Conclusions/observations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#univariate-and-bivariate-analysis-using-ydata-profiling">Univariate and Bivariate Analysis using Ydata Profiling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#miscellaneous-analysis">Miscellaneous Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-sales-with-respect-to-date-and-holidays">Checking sales with respect to date and holidays</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#observations">Observations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#store-wise-aggregate-metrics">Store wise Aggregate metrics</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unemployment-rate-analysis">Unemployment Rate Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sales-and-unemployment-comparison">Sales and Unemployment comparison</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#correlation-between-unemployment-rate-and-sales">Correlation between unemployment rate and sales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decomposition-of-store-wise-weekly-sales">Decomposition of Store-wise Weekly Sales</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stl-decomposition-of-weekly-sales-for-selected-stores">STL Decomposition of weekly_sales for selected stores</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mstl-to-capture-monthly-and-annual-seasonality-separately">MSTL to capture monthly and annual seasonality separately?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature-effect">Temperature Effect</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-correlation-between-weekly-sales-and-temperature">Checking correlation between weekly_sales and temperature</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Observations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonal-decomposition-of-temperature">Seasonal Decomposition of Temperature</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Observations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consumer-price-index">Consumer Price Index</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-correlation-between-weekly-sales-and-its-trend-component-with-cpi">Checking correlation between weekly_sales and its trend component with CPI</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fuel-price">Fuel Price</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-correlation-between-weekly-sales-and-its-trend-component-with-fuel-price">Checking correlation between weekly_sales and its trend component with Fuel Price</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Store Performance Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-all-metrics-and-corresponding-store-ranks">Calculating all metrics and corresponding store ranks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#average-weekly-sales">Average Weekly Sales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#percentage-growth-in-sales">Percentage Growth in Sales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-growth-in-terms-of-trend-of-weekly-sales">Linear growth in terms of Trend of Weekly Sales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#volatility-of-sales">Volatility of Sales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#composite-metric">Composite Metric</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">Conclusions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-correlation-between-unemployment-fuel-price-and-cpi">Checking correlation between unemployment, fuel_price and cpi</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pca-with-cpi-fuel-price-and-unemployment">PCA with CPI, Fuel Price, and Unemployment</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why">Why?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-observations">Conclusion/Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stationarity">Stationarity</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transformations">Transformations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Observations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonal-decomposition-of-differences">Seasonal Decomposition of Differences</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Observations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonal-differencing">Seasonal Differencing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Observations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adf-and-kpss-test-for-stationarity">ADF and KPSS test for stationarity</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adf-for-1st-order-differences">ADF for 1st order differences</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Observations</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adf-for-2nd-order-differences">ADF for 2nd order differences</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Observations</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#kpss-test-for-1st-difference">KPSS test for 1st difference</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">Observations</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#kpss-test-for-2nd-difference">KPSS test for 2nd difference</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">Observations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#auto-correlation-and-partial-autocorrelation">Auto-correlation and Partial Autocorrelation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-eda-to-do">Extra EDA To Do</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="analysis">
<h1>Analysis<a class="headerlink" href="#analysis" title="Link to this heading">#</a></h1>
<section id="importing-libraries-and-dataset">
<h2>Importing Libraries and Dataset<a class="headerlink" href="#importing-libraries-and-dataset" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="c1"># from ydata_profiling import ProfileReport</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.seasonal</span><span class="w"> </span><span class="kn">import</span> <span class="n">STL</span><span class="p">,</span> <span class="n">MSTL</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.graphics.tsaplots</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

<span class="k">def</span><span class="w"> </span><span class="nf">displayHorizontalDataframes</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">titles</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display a list of pandas dataframes horizontally with titles on top.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    dfs (list): List of pandas DataFrames.</span>
<span class="sd">    titles (list): List of titles (strings) corresponding to each DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">titles</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of dataframes and titles must be the same.&quot;</span><span class="p">)</span>

    <span class="c1"># Start a flex container to align content horizontally and center them.</span>
    <span class="n">html</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;&lt;div style=&#39;display: flex; justify-content: center; &quot;</span>
        <span class="s2">&quot;align-items: flex-start;&#39;&gt;&quot;</span>
    <span class="p">)</span>
    
    <span class="c1"># Iterate over the dataframes and their corresponding titles.</span>
    <span class="k">for</span> <span class="n">df</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">titles</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;div style=&#39;margin-left: 20px; margin-right: 20px; text-align: center;&#39;&gt;&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;&lt;h3&gt;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">border</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="s2">&quot;&lt;/div&gt;&quot;</span>
        <span class="p">)</span>
    
    <span class="n">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">custom_repr_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Apply a custom style that sets the font size for &lt;td&gt; and &lt;th&gt; elements.</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_table_styles</span><span class="p">(</span>
        <span class="p">[{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;td, th&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;font-size&#39;</span><span class="p">,</span> <span class="s1">&#39;12.5px&#39;</span><span class="p">)]}]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">_repr_html_</span><span class="p">()</span>

<span class="c1"># Override the default _repr_html_ method for all DataFrames.</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">_repr_html_</span> <span class="o">=</span> <span class="n">custom_repr_html</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../Stationary/Data/walmart.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="preliminary-data-cleaning">
<h2>Preliminary Data Cleaning<a class="headerlink" href="#preliminary-data-cleaning" title="Link to this heading">#</a></h2>
<div class="cell tag_no-execute docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 6435 entries, 0 to 6434
Data columns (total 8 columns):
 #   Column        Non-Null Count  Dtype  
---  ------        --------------  -----  
 0   Store         6435 non-null   int64  
 1   Date          6435 non-null   object 
 2   Weekly_Sales  6435 non-null   float64
 3   Holiday_Flag  6435 non-null   int64  
 4   Temperature   6435 non-null   float64
 5   Fuel_Price    6435 non-null   float64
 6   CPI           6435 non-null   float64
 7   Unemployment  6435 non-null   float64
dtypes: float64(5), int64(2), object(1)
memory usage: 402.3+ KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Store&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_4e3df td {
  font-size: 12.5px;
}
#T_4e3df  th {
  font-size: 12.5px;
}
</style>
<table id="T_4e3df">
  <thead>
    <tr>
      <th class="blank" >&nbsp;</th>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_4e3df_level0_col0" class="col_heading level0 col0" >Weekly_Sales</th>
      <th id="T_4e3df_level0_col1" class="col_heading level0 col1" >Holiday_Flag</th>
      <th id="T_4e3df_level0_col2" class="col_heading level0 col2" >Temperature</th>
      <th id="T_4e3df_level0_col3" class="col_heading level0 col3" >Fuel_Price</th>
      <th id="T_4e3df_level0_col4" class="col_heading level0 col4" >CPI</th>
      <th id="T_4e3df_level0_col5" class="col_heading level0 col5" >Unemployment</th>
    </tr>
    <tr>
      <th class="index_name level0" >Date</th>
      <th class="index_name level1" >Store</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_4e3df_level0_row0" class="row_heading level0 row0" >05-02-2010</th>
      <th id="T_4e3df_level1_row0" class="row_heading level1 row0" >1</th>
      <td id="T_4e3df_row0_col0" class="data row0 col0" >1643690.900000</td>
      <td id="T_4e3df_row0_col1" class="data row0 col1" >0</td>
      <td id="T_4e3df_row0_col2" class="data row0 col2" >42.310000</td>
      <td id="T_4e3df_row0_col3" class="data row0 col3" >2.572000</td>
      <td id="T_4e3df_row0_col4" class="data row0 col4" >211.096358</td>
      <td id="T_4e3df_row0_col5" class="data row0 col5" >8.106000</td>
    </tr>
    <tr>
      <th id="T_4e3df_level0_row1" class="row_heading level0 row1" >12-02-2010</th>
      <th id="T_4e3df_level1_row1" class="row_heading level1 row1" >1</th>
      <td id="T_4e3df_row1_col0" class="data row1 col0" >1641957.440000</td>
      <td id="T_4e3df_row1_col1" class="data row1 col1" >1</td>
      <td id="T_4e3df_row1_col2" class="data row1 col2" >38.510000</td>
      <td id="T_4e3df_row1_col3" class="data row1 col3" >2.548000</td>
      <td id="T_4e3df_row1_col4" class="data row1 col4" >211.242170</td>
      <td id="T_4e3df_row1_col5" class="data row1 col5" >8.106000</td>
    </tr>
    <tr>
      <th id="T_4e3df_level0_row2" class="row_heading level0 row2" >19-02-2010</th>
      <th id="T_4e3df_level1_row2" class="row_heading level1 row2" >1</th>
      <td id="T_4e3df_row2_col0" class="data row2 col0" >1611968.170000</td>
      <td id="T_4e3df_row2_col1" class="data row2 col1" >0</td>
      <td id="T_4e3df_row2_col2" class="data row2 col2" >39.930000</td>
      <td id="T_4e3df_row2_col3" class="data row2 col3" >2.514000</td>
      <td id="T_4e3df_row2_col4" class="data row2 col4" >211.289143</td>
      <td id="T_4e3df_row2_col5" class="data row2 col5" >8.106000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Store&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_47d2c td {
  font-size: 12.5px;
}
#T_47d2c  th {
  font-size: 12.5px;
}
</style>
<table id="T_47d2c">
  <thead>
    <tr>
      <th class="blank" >&nbsp;</th>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_47d2c_level0_col0" class="col_heading level0 col0" >Weekly_Sales</th>
      <th id="T_47d2c_level0_col1" class="col_heading level0 col1" >Holiday_Flag</th>
      <th id="T_47d2c_level0_col2" class="col_heading level0 col2" >Temperature</th>
      <th id="T_47d2c_level0_col3" class="col_heading level0 col3" >Fuel_Price</th>
      <th id="T_47d2c_level0_col4" class="col_heading level0 col4" >CPI</th>
      <th id="T_47d2c_level0_col5" class="col_heading level0 col5" >Unemployment</th>
    </tr>
    <tr>
      <th class="index_name level0" >Date</th>
      <th class="index_name level1" >Store</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_47d2c_level0_row0" class="row_heading level0 row0" >12-10-2012</th>
      <th id="T_47d2c_level1_row0" class="row_heading level1 row0" >45</th>
      <td id="T_47d2c_row0_col0" class="data row0 col0" >734464.360000</td>
      <td id="T_47d2c_row0_col1" class="data row0 col1" >0</td>
      <td id="T_47d2c_row0_col2" class="data row0 col2" >54.470000</td>
      <td id="T_47d2c_row0_col3" class="data row0 col3" >4.000000</td>
      <td id="T_47d2c_row0_col4" class="data row0 col4" >192.327265</td>
      <td id="T_47d2c_row0_col5" class="data row0 col5" >8.667000</td>
    </tr>
    <tr>
      <th id="T_47d2c_level0_row1" class="row_heading level0 row1" >19-10-2012</th>
      <th id="T_47d2c_level1_row1" class="row_heading level1 row1" >45</th>
      <td id="T_47d2c_row1_col0" class="data row1 col0" >718125.530000</td>
      <td id="T_47d2c_row1_col1" class="data row1 col1" >0</td>
      <td id="T_47d2c_row1_col2" class="data row1 col2" >56.470000</td>
      <td id="T_47d2c_row1_col3" class="data row1 col3" >3.969000</td>
      <td id="T_47d2c_row1_col4" class="data row1 col4" >192.330854</td>
      <td id="T_47d2c_row1_col5" class="data row1 col5" >8.667000</td>
    </tr>
    <tr>
      <th id="T_47d2c_level0_row2" class="row_heading level0 row2" >26-10-2012</th>
      <th id="T_47d2c_level1_row2" class="row_heading level1 row2" >45</th>
      <td id="T_47d2c_row2_col0" class="data row2 col0" >760281.430000</td>
      <td id="T_47d2c_row2_col1" class="data row2 col1" >0</td>
      <td id="T_47d2c_row2_col2" class="data row2 col2" >58.850000</td>
      <td id="T_47d2c_row2_col3" class="data row2 col3" >3.882000</td>
      <td id="T_47d2c_row2_col4" class="data row2 col4" >192.308899</td>
      <td id="T_47d2c_row2_col5" class="data row2 col5" >8.667000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">cleaning</span><span class="p">(</span><span class="n">df_copy</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%m-%Y&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Store&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Store&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">StringDtype</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Holiday_Flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Holiday_Flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">BooleanDtype</span><span class="p">())</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">cleaning</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="final-major-observations">
<h2>Final/Major Observations<a class="headerlink" href="#final-major-observations" title="Link to this heading">#</a></h2>
<div class="dropdown admonition">
<p class="admonition-title">Final/Major Observations</p>
<h3 class="rubric" id="data-overview">Data Overview</h3>
<ol class="arabic simple">
<li><p><strong>Dataset Scope</strong></p>
<ul class="simple">
<li><p>The data covers weekly sales for 45 unique stores over 143 weeks (from February 5, 2010, to October 26, 2012).</p></li>
<li><p>There are no missing values in the dataset.</p></li>
</ul>
</li>
<li><p><strong>Feature Specifics</strong></p>
<ul class="simple">
<li><p>Most variables (weekly_sales, temperature, fuel_price, CPI, unemployment) vary by both store and date.</p></li>
<li><p>Only the <code class="docutils literal notranslate"><span class="pre">holiday_flag</span></code> is common across all stores, and it is highly imbalanced with only about 10% of the weeks marked as holidays.</p></li>
</ul>
</li>
</ol>
<hr class="docutils" />
<h3 class="rubric" id="holiday-effects-and-seasonality">Holiday Effects and Seasonality</h3>
<ol class="arabic simple">
<li><p><strong>Holiday-Driven Sales Boosts</strong></p>
<ul class="simple">
<li><p>A visual inspection of the sales data shows clear seasonal spikes that align with holidays. The key holiday periods include:</p>
<ul>
<li><p><strong>Valentine’s Day or Superbowl:</strong> Typically the 2nd week of February.</p></li>
<li><p><strong>Labour Day/Back to School:</strong> Around the 1st or 2nd week of September.</p></li>
<li><p><strong>Thanksgiving and Black Friday:</strong> Generally in the 3rd and/or 4th week of November (around November 24th).</p></li>
<li><p><strong>Christmas and New Year:</strong> Mostly in the 3rd and/or 4th week of December (close to December 24th).</p></li>
<li><p><strong>Independence Day:</strong> A boost is visible in a few stores during the 1st week of July (around July 4th).</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Seasonal Decomposition Challenges</strong></p>
<ul class="simple">
<li><p>Although the series exhibits a seasonal pattern, the timing of holiday boosts is irregular.</p></li>
<li><p>Standard seasonal decomposition methods (e.g., STL) struggle to capture a “smooth” seasonal component because the holidays are not evenly spaced throughout the year even though the nominal season is 52 weeks.</p></li>
</ul>
</li>
</ol>
<hr class="docutils" />
<h3 class="rubric" id="sales-patterns-and-store-specific-trends">Sales Patterns and Store-Specific Trends</h3>
<ol class="arabic simple">
<li><p><strong>General Trend Behavior</strong></p>
<ul class="simple">
<li><p>The sales series generally appear additive with clear holiday-induced boosts overlaid on an overall trend.</p></li>
<li><p>Notably, <strong>Store 36</strong> is an outlier: its weekly sales show a clear downward trend with no apparent seasonal effects.</p></li>
</ul>
</li>
<li><p><strong>Impact by Holiday Type</strong></p>
<ul class="simple">
<li><p><strong>Black Friday and New Year’s</strong> show the strongest influence on boosting sales.</p></li>
<li><p><strong>Valentine’s Week</strong> offers a noticeable, though less significant, increase.</p></li>
<li><p><strong>Labour Day</strong> appears to make little difference for most stores.</p></li>
</ul>
</li>
</ol>
<hr class="docutils" />
<h3 class="rubric" id="economic-indicators-cpi-unemployment-and-fuel-price">Economic Indicators: CPI, Unemployment, and Fuel Price</h3>
<ol class="arabic simple">
<li><p><strong>Unemployment</strong></p>
<ul class="simple">
<li><p>When comparing weekly sales with unemployment, the trend component of sales appears more correlated than the raw data.</p></li>
<li><p>However, the relationship is inconsistent across stores—sometimes showing strong positive, sometimes strong negative, and occasionally near zero.</p></li>
</ul>
</li>
<li><p><strong>Consumer Price Index (CPI) and Fuel Price</strong></p>
<ul class="simple">
<li><p>Direct correlations between weekly sales and CPI are minimal, but when examining only the trend component, there is a generally significant (often positive) correlation in many stores.</p></li>
<li><p>Fuel Price follows a similar pattern as CPI; many stores show positive correlations with sales, yet some exhibit negative or insignificant relationships.</p></li>
</ul>
</li>
<li><p><strong>Interrelationships Among Variables</strong></p>
<ul class="simple">
<li><p><strong>CPI and Fuel Price:</strong> These are strongly positively correlated for all stores (average Pearson correlation coefficient of 0.814), which makes sense because fuel cost is an important component of CPI.</p></li>
<li><p><strong>Unemployment vs. CPI/Fuel Price:</strong> In most cases, unemployment is strongly negatively correlated with both CPI and Fuel Price (with many stores showing correlations greater than 0.73 in magnitude for CPI), though there are exceptions (e.g., Store 24 shows a strong positive correlation).</p></li>
</ul>
</li>
</ol>
<hr class="docutils" />
<h3 class="rubric" id="dimensionality-reduction-with-pca">Dimensionality Reduction with PCA</h3>
<ul class="simple">
<li><p><strong>Purpose:</strong><br />
With only 143 observations per store and several related economic indicators, reducing dimensions can help with model efficiency.</p></li>
<li><p><strong>Findings:</strong></p>
<ul>
<li><p>Reducing CPI, unemployment, and Fuel Price to <strong>two principal components</strong> captures on average 97% of the variance.</p></li>
<li><p>A single principal component only explains about 83% of the variance, making the two-component solution much more effective.</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
<h3 class="rubric" id="store-performance-analysis">Store Performance Analysis</h3>
<ol class="arabic simple">
<li><p><strong>Developed Metrics</strong><br />
A range of performance measures were considered:</p>
<ul class="simple">
<li><p><strong>Average Sales:</strong> Basic measure but influenced by differing sales scales.</p></li>
<li><p><strong>Total Relative Sales Growth:</strong> Percentage increase from the first to the last week.</p></li>
<li><p><strong>Trend-Based Growth (Linear Regression Slope):</strong> Captures overall growth over time and is deemed the most robust metric.</p></li>
<li><p><strong>Sales Volatility:</strong> Based on the normalized residuals from seasonal decomposition, reflecting the stability of sales.</p></li>
<li><p><strong>Composite Score:</strong> A weighted average of the above metrics where the weights are:</p>
<ul>
<li><p>Average Sales: 5%</p></li>
<li><p>Relative Growth: 25%</p></li>
<li><p>Trend Slope: 60%</p></li>
<li><p>Volatility: 10%</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Results</strong></p>
<ul class="simple">
<li><p>The top performers based on the composite score are Stores <strong>39, 4, 41,</strong> and <strong>13</strong>.</p></li>
<li><p>The lower performers include Stores <strong>15, 27, 14, 36,</strong> and <strong>35</strong>.</p></li>
</ul>
</li>
</ol>
<hr class="docutils" />
<h3 class="rubric" id="stationarity-and-modeling">Stationarity and Modeling</h3>
<ol class="arabic simple">
<li><p><strong>Stationarity Testing</strong></p>
<ul class="simple">
<li><p><strong>ADF Test (First Differences):</strong></p>
<ul>
<li><p>All stores show strong stationarity with p-values well below the 0.05 threshold.</p></li>
<li><p>In the second differencing test, all stores except for 33 and 38 maintained stationarity.</p></li>
</ul>
</li>
<li><p><strong>KPSS Test:</strong></p>
<ul>
<li><p>For the first difference, nearly all stores support stationarity (with the exception of Store 16).</p></li>
<li><p>The second differencing results mimic the first, with Store 16 again showing an exception.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>ARIMA and SARIMA Model Candidates</strong></p>
<ul class="simple">
<li><p>Based on ACF/PACF analyses, candidate orders for AR and MA parts were identified:</p>
<ul>
<li><p><strong>Non-seasonal ARIMA models</strong> include configurations such as (6, 1, 4), (6, 1, 5), (6, 2, 4), (6, 2, 5), (9, 2, 4), and (9, 2, 5).</p></li>
<li><p><strong>Seasonal ARIMA (SARIMA) models</strong> add a seasonal component (e.g., (2, 1, 5, 52)) to capture recurring annual patterns.</p></li>
</ul>
</li>
</ul>
</li>
</ol>
<hr class="docutils" />
<h3 class="rubric" id="summary-of-key-takeaways">Summary of Key Takeaways</h3>
<ul class="simple">
<li><p><strong>Holiday Effects Drive Seasonality:</strong><br />
Sales are boosted primarily by holidays. However, because these events do not occur at fixed, regular intervals throughout the year, standard seasonal decomposition methods have difficulty capturing the pattern smoothly.</p></li>
<li><p><strong>Variability in Economic Impact:</strong><br />
While economic indicators like CPI, unemployment, and Fuel Price do affect sales trends, the strength and direction of their relationships vary considerably by store. Using PCA to reduce these dimensions proves beneficial.</p></li>
<li><p><strong>Modeling Readiness:</strong><br />
Stationarity tests on differenced series support the use of ARIMA/SARIMA models, with several promising candidate configurations based on our ACF/PACF assessments.</p></li>
<li><p><strong>Store-Specific Insights:</strong><br />
Composite performance metrics reveal clear differences in store performance, highlighting potential areas for strategic focus (both for high performers and those lagging).</p></li>
</ul>
</div>
</section>
<section id="checking-if-features-vary-only-with-date-or-store-too">
<h2>Checking if features vary only with date or store too<a class="headerlink" href="#checking-if-features-vary-only-with-date-or-store-too" title="Link to this heading">#</a></h2>
<section id="cpi">
<h3>CPI<a class="headerlink" href="#cpi" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">])[</span><span class="s1">&#39;cpi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">temp</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_ac2b8 td {
  font-size: 12.5px;
}
#T_ac2b8  th {
  font-size: 12.5px;
}
</style>
<table id="T_ac2b8">
  <thead>
    <tr>
      <th class="index_name level0" >store</th>
      <th id="T_ac2b8_level0_col0" class="col_heading level0 col0" >30</th>
      <th id="T_ac2b8_level0_col1" class="col_heading level0 col1" >22</th>
      <th id="T_ac2b8_level0_col2" class="col_heading level0 col2" >24</th>
      <th id="T_ac2b8_level0_col3" class="col_heading level0 col3" >17</th>
      <th id="T_ac2b8_level0_col4" class="col_heading level0 col4" >42</th>
      <th id="T_ac2b8_level0_col5" class="col_heading level0 col5" >9</th>
      <th id="T_ac2b8_level0_col6" class="col_heading level0 col6" >6</th>
      <th id="T_ac2b8_level0_col7" class="col_heading level0 col7" >7</th>
      <th id="T_ac2b8_level0_col8" class="col_heading level0 col8" >34</th>
      <th id="T_ac2b8_level0_col9" class="col_heading level0 col9" >45</th>
    </tr>
    <tr>
      <th class="index_name level0" >date</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
      <th class="blank col6" >&nbsp;</th>
      <th class="blank col7" >&nbsp;</th>
      <th class="blank col8" >&nbsp;</th>
      <th class="blank col9" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_ac2b8_level0_row0" class="row_heading level0 row0" >2011-02-25 00:00:00</th>
      <td id="T_ac2b8_row0_col0" class="data row0 col0" >213.190000</td>
      <td id="T_ac2b8_row0_col1" class="data row0 col1" >137.380000</td>
      <td id="T_ac2b8_row0_col2" class="data row0 col2" >133.490000</td>
      <td id="T_ac2b8_row0_col3" class="data row0 col3" >128.130000</td>
      <td id="T_ac2b8_row0_col4" class="data row0 col4" >128.130000</td>
      <td id="T_ac2b8_row0_col5" class="data row0 col5" >217.110000</td>
      <td id="T_ac2b8_row0_col6" class="data row0 col6" >215.070000</td>
      <td id="T_ac2b8_row0_col7" class="data row0 col7" >191.960000</td>
      <td id="T_ac2b8_row0_col8" class="data row0 col8" >128.130000</td>
      <td id="T_ac2b8_row0_col9" class="data row0 col9" >184.160000</td>
    </tr>
    <tr>
      <th id="T_ac2b8_level0_row1" class="row_heading level0 row1" >2011-03-25 00:00:00</th>
      <td id="T_ac2b8_row1_col0" class="data row1 col0" >214.250000</td>
      <td id="T_ac2b8_row1_col1" class="data row1 col1" >137.850000</td>
      <td id="T_ac2b8_row1_col2" class="data row1 col2" >133.960000</td>
      <td id="T_ac2b8_row1_col3" class="data row1 col3" >128.620000</td>
      <td id="T_ac2b8_row1_col4" class="data row1 col4" >128.620000</td>
      <td id="T_ac2b8_row1_col5" class="data row1 col5" >218.200000</td>
      <td id="T_ac2b8_row1_col6" class="data row1 col6" >216.140000</td>
      <td id="T_ac2b8_row1_col7" class="data row1 col7" >192.200000</td>
      <td id="T_ac2b8_row1_col8" class="data row1 col8" >128.620000</td>
      <td id="T_ac2b8_row1_col9" class="data row1 col9" >184.990000</td>
    </tr>
    <tr>
      <th id="T_ac2b8_level0_row2" class="row_heading level0 row2" >2012-03-23 00:00:00</th>
      <td id="T_ac2b8_row2_col0" class="data row2 col0" >220.920000</td>
      <td id="T_ac2b8_row2_col1" class="data row2 col1" >141.630000</td>
      <td id="T_ac2b8_row2_col2" class="data row2 col2" >137.660000</td>
      <td id="T_ac2b8_row2_col3" class="data row2 col3" >130.900000</td>
      <td id="T_ac2b8_row2_col4" class="data row2 col4" >130.900000</td>
      <td id="T_ac2b8_row2_col5" class="data row2 col5" >225.030000</td>
      <td id="T_ac2b8_row2_col6" class="data row2 col6" >222.890000</td>
      <td id="T_ac2b8_row2_col7" class="data row2 col7" >197.230000</td>
      <td id="T_ac2b8_row2_col8" class="data row2 col8" >130.900000</td>
      <td id="T_ac2b8_row2_col9" class="data row2 col9" >190.540000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="temperature">
<h3>Temperature<a class="headerlink" href="#temperature" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">])[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">temp</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_f442a td {
  font-size: 12.5px;
}
#T_f442a  th {
  font-size: 12.5px;
}
</style>
<table id="T_f442a">
  <thead>
    <tr>
      <th class="index_name level0" >store</th>
      <th id="T_f442a_level0_col0" class="col_heading level0 col0" >6</th>
      <th id="T_f442a_level0_col1" class="col_heading level0 col1" >8</th>
      <th id="T_f442a_level0_col2" class="col_heading level0 col2" >17</th>
      <th id="T_f442a_level0_col3" class="col_heading level0 col3" >40</th>
      <th id="T_f442a_level0_col4" class="col_heading level0 col4" >39</th>
      <th id="T_f442a_level0_col5" class="col_heading level0 col5" >1</th>
      <th id="T_f442a_level0_col6" class="col_heading level0 col6" >27</th>
      <th id="T_f442a_level0_col7" class="col_heading level0 col7" >43</th>
      <th id="T_f442a_level0_col8" class="col_heading level0 col8" >42</th>
      <th id="T_f442a_level0_col9" class="col_heading level0 col9" >14</th>
    </tr>
    <tr>
      <th class="index_name level0" >date</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
      <th class="blank col6" >&nbsp;</th>
      <th class="blank col7" >&nbsp;</th>
      <th class="blank col8" >&nbsp;</th>
      <th class="blank col9" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_f442a_level0_row0" class="row_heading level0 row0" >2011-07-08 00:00:00</th>
      <td id="T_f442a_row0_col0" class="data row0 col0" >88.360000</td>
      <td id="T_f442a_row0_col1" class="data row0 col1" >83.570000</td>
      <td id="T_f442a_row0_col2" class="data row0 col2" >70.600000</td>
      <td id="T_f442a_row0_col3" class="data row0 col3" >67.860000</td>
      <td id="T_f442a_row0_col4" class="data row0 col4" >84.330000</td>
      <td id="T_f442a_row0_col5" class="data row0 col5" >85.830000</td>
      <td id="T_f442a_row0_col6" class="data row0 col6" >76.870000</td>
      <td id="T_f442a_row0_col7" class="data row0 col7" >87.020000</td>
      <td id="T_f442a_row0_col8" class="data row0 col8" >88.570000</td>
      <td id="T_f442a_row0_col9" class="data row0 col9" >77.490000</td>
    </tr>
    <tr>
      <th id="T_f442a_level0_row1" class="row_heading level0 row1" >2011-05-20 00:00:00</th>
      <td id="T_f442a_row1_col0" class="data row1 col0" >72.010000</td>
      <td id="T_f442a_row1_col1" class="data row1 col1" >65.540000</td>
      <td id="T_f442a_row1_col2" class="data row1 col2" >51.930000</td>
      <td id="T_f442a_row1_col3" class="data row1 col3" >56.380000</td>
      <td id="T_f442a_row1_col4" class="data row1 col4" >73.310000</td>
      <td id="T_f442a_row1_col5" class="data row1 col5" >67.630000</td>
      <td id="T_f442a_row1_col6" class="data row1 col6" >60.220000</td>
      <td id="T_f442a_row1_col7" class="data row1 col7" >74.210000</td>
      <td id="T_f442a_row1_col8" class="data row1 col8" >72.620000</td>
      <td id="T_f442a_row1_col9" class="data row1 col9" >62.280000</td>
    </tr>
    <tr>
      <th id="T_f442a_level0_row2" class="row_heading level0 row2" >2012-04-06 00:00:00</th>
      <td id="T_f442a_row2_col0" class="data row2 col0" >71.600000</td>
      <td id="T_f442a_row2_col1" class="data row2 col1" >62.180000</td>
      <td id="T_f442a_row2_col2" class="data row2 col2" >43.920000</td>
      <td id="T_f442a_row2_col3" class="data row2 col3" >36.540000</td>
      <td id="T_f442a_row2_col4" class="data row2 col4" >73.490000</td>
      <td id="T_f442a_row2_col5" class="data row2 col5" >70.430000</td>
      <td id="T_f442a_row2_col6" class="data row2 col6" >48.730000</td>
      <td id="T_f442a_row2_col7" class="data row2 col7" >64.700000</td>
      <td id="T_f442a_row2_col8" class="data row2 col8" >65.990000</td>
      <td id="T_f442a_row2_col9" class="data row2 col9" >49.730000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="holidays">
<h3>Holidays<a class="headerlink" href="#holidays" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ndf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">])[</span><span class="s1">&#39;holiday_flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">ndf</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ndf</span><span class="p">[</span><span class="n">ndf</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">ndf</span><span class="p">[</span><span class="n">column</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="conclusions-observations">
<h4>Conclusions/observations<a class="headerlink" href="#conclusions-observations" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Except holiday_flag, all other variables like weekly_sales, temperature, fuel_price, cpi, unemployment are unique to each store and date.</p></li>
<li><p>holiday_flag is common for all stores.</p></li>
</ul>
</section>
</section>
</section>
<section id="univariate-and-bivariate-analysis-using-ydata-profiling">
<h2>Univariate and Bivariate Analysis using Ydata Profiling<a class="headerlink" href="#univariate-and-bivariate-analysis-using-ydata-profiling" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for store in df[&#39;store&#39;].unique():</span>
<span class="c1">#     temp = df.loc[df[&#39;store&#39;] == store].drop(columns=[&#39;store&#39;]).copy()</span>
<span class="c1">#     report = ProfileReport(temp, title=f&#39;Store {store}&#39;)</span>
<span class="c1">#     report.to_file(f&#39;Reports/store_{store}.html&#39;, silent=True)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="miscellaneous-analysis">
<h2>Miscellaneous Analysis<a class="headerlink" href="#miscellaneous-analysis" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span><span class="s1">&#39;Year&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_74434 td {
  font-size: 12.5px;
}
#T_74434  th {
  font-size: 12.5px;
}
</style>
<table id="T_74434">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_74434_level0_col0" class="col_heading level0 col0" >Year</th>
      <th id="T_74434_level0_col1" class="col_heading level0 col1" >count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_74434_level0_row0" class="row_heading level0 row0" >1</th>
      <td id="T_74434_row0_col0" class="data row0 col0" >2010</td>
      <td id="T_74434_row0_col1" class="data row0 col1" >48</td>
    </tr>
    <tr>
      <th id="T_74434_level0_row1" class="row_heading level0 row1" >0</th>
      <td id="T_74434_row1_col0" class="data row1 col0" >2011</td>
      <td id="T_74434_row1_col1" class="data row1 col1" >52</td>
    </tr>
    <tr>
      <th id="T_74434_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_74434_row2_col0" class="data row2 col0" >2012</td>
      <td id="T_74434_row2_col1" class="data row2 col1" >43</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The data is incomplete for years 2010 and 2012. So, the yearly cycle needs to be offset while considering 2010 values as the starting point</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span> 
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="s1">&#39;weekly_sales&#39;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;sales&#39;</span><span class="p">}),</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;date&#39;, ylabel=&#39;sales&#39;&gt;
</pre></div>
</div>
<img alt="../_images/2e7f20b486ea3fa852715b14e5f77de4351f89d8a6d5d91d99301c2350d224a8.png" src="../_images/2e7f20b486ea3fa852715b14e5f77de4351f89d8a6d5d91d99301c2350d224a8.png" />
</div>
</div>
<section id="checking-sales-with-respect-to-date-and-holidays">
<h3>Checking sales with respect to date and holidays<a class="headerlink" href="#checking-sales-with-respect-to-date-and-holidays" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pivot the table</span>
<span class="n">tdf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">store</span> <span class="o">=</span> <span class="s1">&#39;15&#39;</span>
<span class="n">tdf</span><span class="p">[</span><span class="s1">&#39;total_sales&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tdf</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">tdf</span><span class="p">[</span><span class="s1">&#39;holiday_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)[</span><span class="s1">&#39;holiday_flag&#39;</span><span class="p">]</span>
<span class="n">tdf</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Matplotlib/Seaborn code</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>  <span class="c1"># Adjust figure size for width</span>

<span class="c1"># Line plot for weekly sales</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">store</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">tdf</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total Sales&#39;</span><span class="p">)</span>

<span class="c1"># Bar plot for holidays</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">tdf</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">tdf</span><span class="p">[</span><span class="s1">&#39;holiday_flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">tdf</span><span class="p">[</span><span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Holidays&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Customize the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Total Sales&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Weekly Sales and Holidays for Store &#39;</span> <span class="o">+</span> <span class="n">store</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Adjust layout to prevent labels from overlapping</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/d13bcecc271844b6d4b53958f2807d0ee66e309736333b6e05928ebb797b8852.png" src="../_images/d13bcecc271844b6d4b53958f2807d0ee66e309736333b6e05928ebb797b8852.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract the series of holiday dates</span>
<span class="n">holiday_dates</span> <span class="o">=</span> <span class="n">tdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tdf</span><span class="p">[</span><span class="s2">&quot;holiday_flag&quot;</span><span class="p">],</span> <span class="s2">&quot;date&quot;</span><span class="p">]</span>

<span class="c1"># Create DataFrames for each year</span>
<span class="n">holidays_10</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">holiday_dates</span><span class="p">[</span><span class="n">holiday_dates</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2010</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">holidays_11</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">holiday_dates</span><span class="p">[</span><span class="n">holiday_dates</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2011</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">holidays_12</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">holiday_dates</span><span class="p">[</span><span class="n">holiday_dates</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2012</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">holidays_10</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span>
<span class="n">holidays_11</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span>
<span class="n">holidays_12</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">displayHorizontalDataframes</span><span class="p">([</span><span class="n">holidays_10</span><span class="p">,</span> <span class="n">holidays_11</span><span class="p">,</span> <span class="n">holidays_12</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Holidays in 2010&#39;</span><span class="p">,</span> <span class="s1">&#39;Holidays in 2011&#39;</span><span class="p">,</span> <span class="s1">&#39;Holidays in 2012&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style='display: flex; justify-content: center; align-items: flex-start;'><div style='margin-left: 20px; margin-right: 20px; text-align: center;'><h3>Holidays in 2010</h3><table border="1" class="dataframe dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2010-02-12</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2010-09-10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2010-11-26</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2010-12-31</td>
    </tr>
  </tbody>
</table></div><div style='margin-left: 20px; margin-right: 20px; text-align: center;'><h3>Holidays in 2011</h3><table border="1" class="dataframe dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2011-02-11</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2011-09-09</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-11-25</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-12-30</td>
    </tr>
  </tbody>
</table></div><div style='margin-left: 20px; margin-right: 20px; text-align: center;'><h3>Holidays in 2012</h3><table border="1" class="dataframe dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2012-02-10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2012-09-07</td>
    </tr>
  </tbody>
</table></div></div></div></div>
</div>
<section id="observations">
<h4>Observations<a class="headerlink" href="#observations" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>From visually inspecting the weekly_sales, we can clearly see a seasonal trend. The holiday_flags are mostly set for these occassions:</p>
<ul>
<li><p>Valentines day (Feb 2nd week)</p></li>
<li><p>Labour day/ back to school (Sep 1st week)</p></li>
<li><p>Thanksgiving and Black Friday (Nov 24th weeok)</p></li>
<li><p>Christmas and New Years (Dec 25th week)</p></li>
<li><p>Also, very few stores also see boost in Sales for Independence day (July 4th week)</p></li>
</ul>
</li>
<li><p>From visual inspection, most sales get boosted by Balck Friday and New Years. Valentines week does see some boost in sales but not as significant as others. Labour day does not seem to have a significant impact on sales.</p></li>
<li><p>Extra and isolated Holiday effects:</p>
<ul>
<li><p>April 6 (specifically 2012)</p></li>
<li><p>August 6</p></li>
<li><p>June 4 (specifically 2011, 2012)</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="store-wise-aggregate-metrics">
<h3>Store wise Aggregate metrics<a class="headerlink" href="#store-wise-aggregate-metrics" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weekly_sales</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">)</span>
<span class="n">wsd</span> <span class="o">=</span> <span class="n">weekly_sales</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="unemployment-rate-analysis">
<h2>Unemployment Rate Analysis<a class="headerlink" href="#unemployment-rate-analysis" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Investigate whether the weekly sales are affected by the unemployment rate.</p></li>
<li><p>Identify which stores are suffering the most if an effect exists.</p></li>
</ul>
<section id="sales-and-unemployment-comparison">
<h3>Sales and Unemployment comparison<a class="headerlink" href="#sales-and-unemployment-comparison" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;12&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Weekly Sales&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;unemployment&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Unemployment&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/23542f7d30b307716af9875e2e12ef554a6fd346f1301e0fb2fb554d98889c1d.png" src="../_images/23542f7d30b307716af9875e2e12ef554a6fd346f1301e0fb2fb554d98889c1d.png" />
</div>
</div>
<p>From Visual inspection of Weekly sales and Unemployment side-byside, no direct correlation can be observed between sales and unemployment rate. However, seasonal decompose might tell us something</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;40&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> 
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;unemployment&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_store</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Weekly Sales vs. Unemployment&#39;</span><span class="p">)</span>
<span class="c1"># plt.show()</span>

<span class="n">pearson</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;unemployment&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pearson Correlation between unemployment and weekly sales: </span><span class="si">{</span><span class="n">pearson</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">spearman</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;unemployment&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Spearman Correlation between unemployment and weekly sales: </span><span class="si">{</span><span class="n">spearman</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">kendall</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;unemployment&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kendall&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kendall Correlation between unemployment and weekly sales: </span><span class="si">{</span><span class="n">kendall</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pearson Correlation between unemployment and weekly sales: -0.11252795058812329
Spearman Correlation between unemployment and weekly sales: -0.1605059665705267
Kendall Correlation between unemployment and weekly sales: -0.11418063280775571
</pre></div>
</div>
<img alt="../_images/554da7466b71b3e4d7360b20159029cebf26fa923c48b0ad74f952a11871bd57.png" src="../_images/554da7466b71b3e4d7360b20159029cebf26fa923c48b0ad74f952a11871bd57.png" />
</div>
</div>
</section>
<section id="correlation-between-unemployment-rate-and-sales">
<h3>Correlation between unemployment rate and sales<a class="headerlink" href="#correlation-between-unemployment-rate-and-sales" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract unique stores</span>
<span class="n">stores</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>  <span class="c1"># Sort for consistent order</span>

<span class="c1"># Initialize correlation storage</span>
<span class="n">correlation_sales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="s1">&#39;Kendall&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">stores</span><span class="p">)</span>
<span class="n">correlation_trend</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="s1">&#39;Kendall&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">stores</span><span class="p">)</span>

<span class="c1"># Compute correlations for each store</span>
<span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">stores</span><span class="p">:</span>
    <span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
    
    <span class="c1"># Extract weekly sales and unemployment</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">]</span>
    <span class="n">unemployment</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;unemployment&#39;</span><span class="p">]</span>
    
    <span class="c1"># Compute correlations (Weekly Sales vs Unemployment)</span>
    <span class="n">correlation_sales</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">unemployment</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
    <span class="n">correlation_sales</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">unemployment</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
    <span class="n">correlation_sales</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Kendall&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">unemployment</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kendall&#39;</span><span class="p">)</span>

    <span class="c1"># Perform STL decomposition</span>
    <span class="n">stl</span> <span class="o">=</span> <span class="n">STL</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">seasonal</span><span class="o">=</span><span class="mi">53</span><span class="p">)</span>  <span class="c1"># Assuming yearly seasonality</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">stl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    
    <span class="c1"># Extract trend component</span>
    <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">trend</span>
    
    <span class="c1"># Compute correlations (Trend vs Unemployment)</span>
    <span class="n">correlation_trend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">unemployment</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
    <span class="n">correlation_trend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">unemployment</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
    <span class="n">correlation_trend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Kendall&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">unemployment</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kendall&#39;</span><span class="p">)</span>

<span class="c1"># Convert to float type (for better plotting)</span>
<span class="n">correlation_sales</span> <span class="o">=</span> <span class="n">correlation_sales</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">correlation_trend</span> <span class="o">=</span> <span class="n">correlation_trend</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># Plot heatmaps</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;height_ratios&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>

<span class="c1"># Sales vs Unemployment Heatmap</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_sales</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Correlation: Weekly Sales vs Unemployment&quot;</span><span class="p">)</span>

<span class="c1"># Trend vs Unemployment Heatmap</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_trend</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Correlation: Trend Component of Weekly Sales vs Unemployment&quot;</span><span class="p">)</span>

<span class="c1"># Adjust layout</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/b69fe4013ac76130df935ebf58b5c1f6c36e5b70763eb1b5f79bcd017754de4d.png" src="../_images/b69fe4013ac76130df935ebf58b5c1f6c36e5b70763eb1b5f79bcd017754de4d.png" />
</div>
</div>
</section>
<section id="id1">
<h3>Observations<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>Looking at it, the trend component of weekly sales is definitely more correlated with unemployment than regular weekly_sales. But, there’s high contrast in how it’s correlated. For most of the stores, it’s strongly negative. For some other stores it’s strongly positive. Few times it’s close to zero. So, I’m not sure if it’s a good indicator of whether there’s a relationship between weekly_sales and unemployment.</p>
</section>
</section>
<section id="decomposition-of-store-wise-weekly-sales">
<h2>Decomposition of Store-wise Weekly Sales<a class="headerlink" href="#decomposition-of-store-wise-weekly-sales" title="Link to this heading">#</a></h2>
<section id="stl-decomposition-of-weekly-sales-for-selected-stores">
<h3>STL Decomposition of weekly_sales for selected stores<a class="headerlink" href="#stl-decomposition-of-weekly-sales-for-selected-stores" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="s1">&#39;12&#39;</span>
<span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span>
<span class="n">df_store</span> <span class="o">=</span> <span class="n">df_store</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>  <span class="c1"># ensure chronological order</span>

<span class="c1"># Set weekly_sales as the target series</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">]</span>

<span class="c1"># We assume an annual (52-week) seasonal period</span>
<span class="n">stl</span> <span class="o">=</span> <span class="n">STL</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">52</span><span class="p">,</span> <span class="n">seasonal</span><span class="o">=</span><span class="mi">53</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">low_pass</span> <span class="o">=</span> <span class="mi">53</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">stl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/533314ea9a8a2a8de1e53d553f372b3f11999994f8da706a52a046e542978831.png" src="../_images/533314ea9a8a2a8de1e53d553f372b3f11999994f8da706a52a046e542978831.png" />
</div>
</div>
</section>
<section id="mstl-to-capture-monthly-and-annual-seasonality-separately">
<h3>MSTL to capture monthly and annual seasonality separately?<a class="headerlink" href="#mstl-to-capture-monthly-and-annual-seasonality-separately" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;12&#39;</span><span class="p">]</span>
<span class="n">df_store</span> <span class="o">=</span> <span class="n">df_store</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>  <span class="c1"># ensure chronological order</span>

<span class="c1"># Set weekly_sales as the target series</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">]</span>

<span class="n">mstl</span> <span class="o">=</span> <span class="n">MSTL</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">52</span><span class="p">],</span> <span class="n">iterate</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">mstl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1c46160334cc697499f8eae28d1a253b72c1bcd69edd37c28908a378e3622894.png" src="../_images/1c46160334cc697499f8eae28d1a253b72c1bcd69edd37c28908a378e3622894.png" />
</div>
</div>
</section>
<section id="id2">
<h3>Observations<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>From visual inspection of the Times series decomposition plot using STL and MSTL, what I noticed is it cannot properly decompose the sales into a “nice” continuous seasonal component. The seasonal effect is directly due to the recurring holiday sales boots, but they are randomly distributed over the year and repeat yearly. It’s not like every month there’s a holiday at a fixed interval. They are inconsistently distributed. So, technically the season is 52 weeks long. But, the seasonal effect is not efficiently captured by the STL decomposition.</p>
</section>
</section>
<section id="temperature-effect">
<h2>Temperature Effect<a class="headerlink" href="#temperature-effect" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Examine if temperature influences weekly sales.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="s1">&#39;11&#39;</span>
<span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>

<span class="c1"># Create stacked subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Sales&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Sales and Temperature&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Temperature&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/649f9b70e442d84caaa7b3984b60145cea3363a821c45bffb4c54bee3f17a500.png" src="../_images/649f9b70e442d84caaa7b3984b60145cea3363a821c45bffb4c54bee3f17a500.png" />
</div>
</div>
<section id="checking-correlation-between-weekly-sales-and-temperature">
<h3>Checking correlation between weekly_sales and temperature<a class="headerlink" href="#checking-correlation-between-weekly-sales-and-temperature" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract unique stores</span>
<span class="n">stores</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>  <span class="c1"># Sort for consistent order</span>

<span class="c1"># Initialize correlation storage</span>
<span class="n">correlation_sales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="s1">&#39;Kendall&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">stores</span><span class="p">)</span>
<span class="n">correlation_trend</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="s1">&#39;Kendall&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">stores</span><span class="p">)</span>
<span class="n">correlation_double_trend</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="s1">&#39;Kendall&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">stores</span><span class="p">)</span>

<span class="c1"># Compute correlations for each store</span>
<span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">stores</span><span class="p">:</span>
    <span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
    
    <span class="c1"># Extract weekly sales and temperature</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">]</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span>
    
    <span class="c1"># Compute correlations (Weekly Sales vs Unemployment)</span>
    <span class="n">correlation_sales</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
    <span class="n">correlation_sales</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
    <span class="n">correlation_sales</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Kendall&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kendall&#39;</span><span class="p">)</span>

    <span class="c1"># Perform STL decomposition</span>
    <span class="n">stl</span> <span class="o">=</span> <span class="n">STL</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">seasonal</span><span class="o">=</span><span class="mi">53</span><span class="p">)</span>  <span class="c1"># Assuming yearly seasonality</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">stl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    
    <span class="c1"># Extract trend component</span>
    <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">trend</span>
    
    <span class="c1"># Compute correlations (Trend vs temperature)</span>
    <span class="n">correlation_trend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
    <span class="n">correlation_trend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
    <span class="n">correlation_trend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Kendall&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kendall&#39;</span><span class="p">)</span>

    <span class="c1"># Perform STL decomposition</span>
    <span class="n">stl2</span> <span class="o">=</span> <span class="n">STL</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">seasonal</span><span class="o">=</span><span class="mi">53</span><span class="p">)</span>  <span class="c1"># Assuming yearly seasonality</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">stl2</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    
    <span class="c1"># Extract trend component</span>
    <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;temperature_trend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">trend</span>
    
    <span class="c1"># Compute correlations (Trend vs temperature)</span>
    <span class="n">correlation_double_trend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;temperature_trend&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
    <span class="n">correlation_double_trend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;temperature_trend&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
    <span class="n">correlation_double_trend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Kendall&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;temperature_trend&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kendall&#39;</span><span class="p">)</span>

<span class="c1"># Convert to float type (for better plotting)</span>
<span class="n">correlation_sales</span> <span class="o">=</span> <span class="n">correlation_sales</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">correlation_trend</span> <span class="o">=</span> <span class="n">correlation_trend</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">correlation_double_trend</span> <span class="o">=</span> <span class="n">correlation_double_trend</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># Plot heatmaps</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;height_ratios&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>

<span class="c1"># Sales vs temperature Heatmap</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_sales</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Correlation: Weekly Sales vs temperature&quot;</span><span class="p">)</span>

<span class="c1"># Trend vs temperature Heatmap</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_trend</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Correlation: Trend Component of Weekly Sales vs temperature&quot;</span><span class="p">)</span>

<span class="c1"># Trend vs temperature trend Heatmap</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_double_trend</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Correlation: Trend Component of Weekly Sales vs Trend component of temperature&quot;</span><span class="p">)</span>

<span class="c1"># Adjust layout</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/80b215c403885577fe6502b6c80b90896af92c05bc5a02f05697402ec0b3fc40.png" src="../_images/80b215c403885577fe6502b6c80b90896af92c05bc5a02f05697402ec0b3fc40.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="s1">&#39;11&#39;</span>
<span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="c1"># Perform STL decomposition for both series</span>
<span class="n">decomp_sales</span> <span class="o">=</span> <span class="n">STL</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">],</span> <span class="n">period</span><span class="o">=</span><span class="mi">52</span><span class="p">,</span> <span class="n">seasonal</span> <span class="o">=</span> <span class="mi">53</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">decomp_temp</span> <span class="o">=</span> <span class="n">STL</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">period</span><span class="o">=</span><span class="mi">52</span><span class="p">,</span> <span class="n">seasonal</span> <span class="o">=</span> <span class="mi">53</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Create stacked subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">decomp_sales</span><span class="o">.</span><span class="n">trend</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Sales Trend&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;STL Decomposition Trends&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">decomp_temp</span><span class="o">.</span><span class="n">trend</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Temperature Trend&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1cdb8afd5eeda67f9210fd9aa77f4187e3a745ff225b7cf49db0da25ee24fcca.png" src="../_images/1cdb8afd5eeda67f9210fd9aa77f4187e3a745ff225b7cf49db0da25ee24fcca.png" />
</div>
</div>
<section id="id3">
<h4>Observations<a class="headerlink" href="#id3" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>From visual inspection of the correlation heatmaps, weekly sales are definitely not correlated with temperature.</p></li>
<li><p>No need for further hypothesis testing to determine if there is a relationship between temperature and weekly sales.</p></li>
</ul>
</section>
</section>
<section id="seasonal-decomposition-of-temperature">
<h3>Seasonal Decomposition of Temperature<a class="headerlink" href="#seasonal-decomposition-of-temperature" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="s1">&#39;20&#39;</span>
<span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>

<span class="c1"># Set weekly_sales as the target series</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span>

<span class="c1"># We assume an annual (52-week) seasonal period</span>
<span class="n">stl</span> <span class="o">=</span> <span class="n">STL</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">52</span><span class="p">,</span> <span class="n">seasonal</span><span class="o">=</span><span class="mi">53</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">low_pass</span> <span class="o">=</span> <span class="mi">53</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">stl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/857593c61cfba7ed22dd2c3df52dc257d69c741f6b93b51fe865c844a26144c4.png" src="../_images/857593c61cfba7ed22dd2c3df52dc257d69c741f6b93b51fe865c844a26144c4.png" />
</div>
</div>
<section id="id4">
<h4>Observations<a class="headerlink" href="#id4" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>From visual inspection, temperature is obviously seasonal, with peaks in summer (American season)</p></li>
</ul>
</section>
</section>
</section>
<section id="consumer-price-index">
<h2>Consumer Price Index<a class="headerlink" href="#consumer-price-index" title="Link to this heading">#</a></h2>
<section id="checking-correlation-between-weekly-sales-and-its-trend-component-with-cpi">
<h3>Checking correlation between weekly_sales and its trend component with CPI<a class="headerlink" href="#checking-correlation-between-weekly-sales-and-its-trend-component-with-cpi" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract unique stores</span>
<span class="n">stores</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>  <span class="c1"># Sort for consistent order</span>

<span class="c1"># Initialize correlation storage</span>
<span class="n">correlation_sales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="s1">&#39;Kendall&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">stores</span><span class="p">)</span>
<span class="n">correlation_trend</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="s1">&#39;Kendall&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">stores</span><span class="p">)</span>

<span class="c1"># Compute correlations for each store</span>
<span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">stores</span><span class="p">:</span>
    <span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
    
    <span class="c1"># Extract weekly sales and cpi</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">]</span>
    <span class="n">cpi</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;cpi&#39;</span><span class="p">]</span>
    
    <span class="c1"># Compute correlations (Weekly Sales vs Unemployment)</span>
    <span class="n">correlation_sales</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">cpi</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
    <span class="n">correlation_sales</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">cpi</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
    <span class="n">correlation_sales</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Kendall&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">cpi</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kendall&#39;</span><span class="p">)</span>

    <span class="c1"># Perform STL decomposition</span>
    <span class="n">stl</span> <span class="o">=</span> <span class="n">STL</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">seasonal</span><span class="o">=</span><span class="mi">53</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">52</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Assuming yearly seasonality</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">stl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    
    <span class="c1"># Extract trend component</span>
    <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">trend</span>
    
    <span class="c1"># Compute correlations (Trend vs cpi)</span>
    <span class="n">correlation_trend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">cpi</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
    <span class="n">correlation_trend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">cpi</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
    <span class="n">correlation_trend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Kendall&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">cpi</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kendall&#39;</span><span class="p">)</span>

<span class="c1"># Convert to float type (for better plotting)</span>
<span class="n">correlation_sales</span> <span class="o">=</span> <span class="n">correlation_sales</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">correlation_trend</span> <span class="o">=</span> <span class="n">correlation_trend</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># Plot heatmaps</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;height_ratios&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>

<span class="c1"># Sales vs cpi Heatmap</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_sales</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Correlation: Weekly Sales vs cpi&quot;</span><span class="p">)</span>

<span class="c1"># Trend vs cpi Heatmap</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_trend</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm_r&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Correlation: Trend Component of Weekly Sales vs cpi&quot;</span><span class="p">)</span>

<span class="c1"># Adjust layout</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/4aed88649497e81df9d5ad1793b28e34d235265767e5edb7e17d30a63da66a69.png" src="../_images/4aed88649497e81df9d5ad1793b28e34d235265767e5edb7e17d30a63da66a69.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="s1">&#39;4&#39;</span>
<span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="c1"># Perform STL decomposition for both series</span>
<span class="n">decomp_sales</span> <span class="o">=</span> <span class="n">STL</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">],</span> <span class="n">period</span><span class="o">=</span><span class="mi">52</span><span class="p">,</span> <span class="n">seasonal</span> <span class="o">=</span> <span class="mi">53</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="c1"># decomp_temp = STL(df_store[&#39;cpi&#39;], period=52, seasonal = 53, robust=False).fit()</span>
<span class="n">cpi</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;cpi&#39;</span><span class="p">]</span>

<span class="c1"># Create stacked subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Sales&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Weekly Sales&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">decomp_sales</span><span class="o">.</span><span class="n">trend</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Sales Trend&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Sales STL Decomposition Trends&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">cpi</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;cpi&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;CPI&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4f1160db2a96df4919056f3143401a994558dac07d84b97d74f4ca772dbf736f.png" src="../_images/4f1160db2a96df4919056f3143401a994558dac07d84b97d74f4ca772dbf736f.png" />
</div>
</div>
</section>
<section id="id5">
<h3>Observations<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>When looking at weekly_sales and cpi directly, the correlations is insignificant. But, when considering only the trend component with respect to CPI, there seems to be a significant correlation.</p></li>
<li><p>Most of the correlations are strongly positive. Very few are strongly negative. And even fewer are weakly positive or negative.</p></li>
<li><p>If for all stores the correlations were in same direction with significant magnitude, then it would hold some meaning. But, it doesn’t.</p></li>
</ul>
</section>
</section>
<section id="fuel-price">
<h2>Fuel Price<a class="headerlink" href="#fuel-price" title="Link to this heading">#</a></h2>
<section id="checking-correlation-between-weekly-sales-and-its-trend-component-with-fuel-price">
<h3>Checking correlation between weekly_sales and its trend component with Fuel Price<a class="headerlink" href="#checking-correlation-between-weekly-sales-and-its-trend-component-with-fuel-price" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract unique stores</span>
<span class="n">stores</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>  <span class="c1"># Sort for consistent order</span>

<span class="c1"># Initialize correlation storage</span>
<span class="n">correlation_sales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="s1">&#39;Kendall&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">stores</span><span class="p">)</span>
<span class="n">correlation_trend</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="s1">&#39;Kendall&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">stores</span><span class="p">)</span>

<span class="c1"># Compute correlations for each store</span>
<span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">stores</span><span class="p">:</span>
    <span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
    
    <span class="c1"># Extract weekly sales and fuel_price</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">]</span>
    <span class="n">fuel_price</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;fuel_price&#39;</span><span class="p">]</span>
    
    <span class="c1"># Compute correlations (Weekly Sales vs Unemployment)</span>
    <span class="n">correlation_sales</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">fuel_price</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
    <span class="n">correlation_sales</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">fuel_price</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
    <span class="n">correlation_sales</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Kendall&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">fuel_price</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kendall&#39;</span><span class="p">)</span>

    <span class="c1"># Perform STL decomposition</span>
    <span class="n">stl</span> <span class="o">=</span> <span class="n">STL</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">seasonal</span><span class="o">=</span><span class="mi">53</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">52</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Assuming yearly seasonality</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">stl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    
    <span class="c1"># Extract trend component</span>
    <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">trend</span>
    
    <span class="c1"># Compute correlations (Trend vs fuel_price)</span>
    <span class="n">correlation_trend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">fuel_price</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
    <span class="n">correlation_trend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">fuel_price</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
    <span class="n">correlation_trend</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Kendall&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">fuel_price</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kendall&#39;</span><span class="p">)</span>

<span class="c1"># Convert to float type (for better plotting)</span>
<span class="n">correlation_sales</span> <span class="o">=</span> <span class="n">correlation_sales</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">correlation_trend</span> <span class="o">=</span> <span class="n">correlation_trend</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># Plot heatmaps</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;height_ratios&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>

<span class="c1"># Sales vs fuel_price Heatmap</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_sales</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Correlation: Weekly Sales vs fuel_price&quot;</span><span class="p">)</span>

<span class="c1"># Trend vs fuel_price Heatmap</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_trend</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Correlation: Trend Component of Weekly Sales vs fuel_price&quot;</span><span class="p">)</span>

<span class="c1"># Adjust layout</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/45cbc0fca1050b6871d6118a2ff43cc13784a5cce22145c6c176fa013e9e6915.png" src="../_images/45cbc0fca1050b6871d6118a2ff43cc13784a5cce22145c6c176fa013e9e6915.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="s1">&#39;4&#39;</span>
<span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="c1"># Perform STL decomposition for both series</span>
<span class="n">decomp_sales</span> <span class="o">=</span> <span class="n">STL</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">],</span> <span class="n">period</span><span class="o">=</span><span class="mi">52</span><span class="p">,</span> <span class="n">seasonal</span> <span class="o">=</span> <span class="mi">53</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="c1"># decomp_temp = STL(df_store[&#39;cpi&#39;], period=52, seasonal = 53, robust=False).fit()</span>
<span class="n">fuel_price</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;fuel_price&#39;</span><span class="p">]</span>

<span class="c1"># Create stacked subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Sales&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Weekly Sales&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">decomp_sales</span><span class="o">.</span><span class="n">trend</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Sales Trend&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Sales STL Decomposition Trends&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">fuel_price</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;fuel_price&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;fuel_price&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/28b14b0600bf427018bb36467191e1ad7ad5c9b18b88b99c316e3502dc58a315.png" src="../_images/28b14b0600bf427018bb36467191e1ad7ad5c9b18b88b99c316e3502dc58a315.png" />
</div>
</div>
</section>
<section id="id6">
<h3>Observations<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Similar to CPI, Fuel Price also for most stores seems to have a strong positive correlation with the sales.</p></li>
<li><p>However, similar to CPI, Fuel Price some of the stores seems to have a negative or insignificant correlation with the sales.</p></li>
<li><p>So, Fuel Price is not a good “global” indicator of the sales.</p></li>
</ul>
</section>
</section>
<section id="id7">
<h2>Store Performance Analysis<a class="headerlink" href="#id7" title="Link to this heading">#</a></h2>
<p>Performance metrics:</p>
<ol class="arabic simple">
<li><p>Average sales:</p>
<ul class="simple">
<li><p>This won’t be a good metric as the scale of sales differs across stores.</p></li>
<li><p>But, it can be a good starting point.</p></li>
</ul>
</li>
<li><p>Total relative growth irrespective of seasons and trends</p>
<ul class="simple">
<li><p>Basically percentage growth of sales from first week to last week.</p></li>
<li><p>This is relatively a better metric compared to the previous one. But, it might still be susceptible to volatility in first and last weeks.</p></li>
</ul>
</li>
<li><p>Total relative growth in terms of trend only</p>
<ul class="simple">
<li><p>What this metric does is fits a linear regression model to the growth of sales over time.</p></li>
<li><p>And then, the slope of the regression line is this metric.</p></li>
<li><p>This is a better metric than both the previous ones, because it accounts for all the data along with its trend.</p></li>
</ul>
</li>
<li><p>Stability/volatility of sales</p>
<ul class="simple">
<li><p>This metric analyzes the volatility of sales relative to the trend.</p></li>
<li><p>It is measured by the standard deviation of the residuals of seasonal decomposition of sales.</p></li>
<li><p>Note: Since the scale of sales differs across stores, I normalize the residuals to bring them on scale of 1 to -1.</p></li>
<li><p>Then their standard deviation is multiplied by 100 to give us final percentage volatility.</p></li>
</ul>
</li>
<li><p>Composite score based on all the above metrics</p>
<ul class="simple">
<li><p>This is the final metric that combines all the above metrics.</p></li>
<li><p>It is calculated by taking the weighted average of all the metrics.</p></li>
<li><p>The weights are based on the importance of each metric.</p>
<ul>
<li><p>Average sales: 5%</p></li>
<li><p>Relative percentage growth: 25%</p></li>
<li><p>Linear Trend slope: 60%</p></li>
<li><p>Volatility: 10%</p></li>
</ul>
</li>
</ul>
</li>
</ol>
<section id="calculating-all-metrics-and-corresponding-store-ranks">
<h3>Calculating all metrics and corresponding store ranks<a class="headerlink" href="#calculating-all-metrics-and-corresponding-store-ranks" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stores</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">performance_records</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">store_id</span> <span class="ow">in</span> <span class="n">stores</span><span class="p">:</span>
    <span class="c1"># 1. Subset data</span>
    <span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store_id</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df_store</span> <span class="o">=</span> <span class="n">df_store</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
    
    <span class="c1"># 3. Decompose using STL (assuming ~52-week season)</span>
    <span class="n">stl</span> <span class="o">=</span> <span class="n">STL</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">],</span> <span class="n">period</span><span class="o">=</span><span class="mi">52</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">stl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    
    <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">trend</span>
    <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;seasonal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">seasonal</span>
    <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;remainder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">resid</span>
    
    <span class="c1"># 4. Compute Trend Slope (via Linear Regression)</span>
    <span class="c1"># Create a numeric index for regression</span>
    <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_store</span><span class="p">))</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_store</span><span class="p">[[</span><span class="s1">&#39;t&#39;</span><span class="p">]],</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">])</span>
    <span class="n">slope</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># 5. Compute % Growth from first to last</span>
    <span class="c1"># start_trend = (df_store[&#39;trend&#39;] + df_store[&#39;remainder&#39;]).iloc[0]</span>
    <span class="c1"># end_trend   = (df_store[&#39;trend&#39;] + df_store[&#39;remainder&#39;]).iloc[-1]</span>
    <span class="n">start_trend</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">end_trend</span>   <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">pct_growth</span>  <span class="o">=</span> <span class="p">((</span><span class="n">end_trend</span> <span class="o">-</span> <span class="n">start_trend</span><span class="p">)</span> <span class="o">/</span> <span class="n">start_trend</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">start_trend</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    
    <span class="c1"># 6. Compute remainder volatility</span>
    <span class="c1"># Compute the minimum and maximum of the residuals for the current store</span>
    <span class="n">res_min</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;remainder&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">res_max</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;remainder&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="c1"># Apply min-max normalization to map residuals to the range [-1, 1]</span>
    <span class="k">if</span> <span class="n">res_max</span> <span class="o">-</span> <span class="n">res_min</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;norm_remainder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;remainder&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">res_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">res_max</span> <span class="o">-</span> <span class="n">res_min</span><span class="p">)</span>
        <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If all residuals are the same, assign 0 (their normalized value)</span>
        <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;norm_remainder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Now compute the standard deviation of the normalized residuals,</span>
    <span class="c1"># and multiply by 100 to express it as a percentage volatility.</span>
    <span class="n">volatility_norm_percent</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;norm_remainder&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
    
    <span class="c1"># 7. Collect performance metrics</span>
    <span class="n">performance_records</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;store&#39;</span><span class="p">:</span> <span class="n">store_id</span><span class="p">,</span>
        <span class="s1">&#39;avg_sales&#39;</span><span class="p">:</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s1">&#39;trend_slope&#39;</span><span class="p">:</span> <span class="n">slope</span><span class="p">,</span>
        <span class="s1">&#39;pct_growth&#39;</span><span class="p">:</span> <span class="n">pct_growth</span><span class="p">,</span>
        <span class="s1">&#39;pct_volatility&#39;</span><span class="p">:</span> <span class="n">volatility_norm_percent</span>
    <span class="p">})</span>

<span class="n">performance_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">performance_records</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">rank_performance</span><span class="p">(</span><span class="n">performance_df</span><span class="p">):</span>
    <span class="c1"># Higher is better</span>
    <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;rank_avg_sales&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;avg_sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;dense&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;rank_slope&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;trend_slope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;dense&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;rank_pct_growth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;pct_growth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;dense&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="c1"># Lower is better for volatility</span>
    <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;rank_volatility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;pct_volatility&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;dense&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Example: Weighted sum of ranks</span>
    <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;overall_rank_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;rank_avg_sales&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.05</span> <span class="o">+</span>
        <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;rank_slope&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.6</span> <span class="o">+</span>
        <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;rank_pct_growth&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.25</span> <span class="o">+</span> 
        <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;rank_volatility&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.1</span>
    <span class="p">)</span>
    
    <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;overall_rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;overall_rank_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;dense&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">performance_df</span>

<span class="n">performance_df</span> <span class="o">=</span> <span class="n">rank_performance</span><span class="p">(</span><span class="n">performance_df</span><span class="p">)</span>

<span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;avg_sales&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;avg_sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;pct_growth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;pct_growth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;trend_slope&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;trend_slope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;pct_volatility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">performance_df</span><span class="p">[</span><span class="s1">&#39;pct_volatility&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="p">[</span><span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">performance_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;rank&#39;</span> <span class="ow">in</span> <span class="n">column</span><span class="p">]:</span>
    <span class="n">performance_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">performance_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">performance_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_acdaa td {
  font-size: 12.5px;
}
#T_acdaa  th {
  font-size: 12.5px;
}
</style>
<table id="T_acdaa">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_acdaa_level0_col0" class="col_heading level0 col0" >store</th>
      <th id="T_acdaa_level0_col1" class="col_heading level0 col1" >avg_sales</th>
      <th id="T_acdaa_level0_col2" class="col_heading level0 col2" >trend_slope</th>
      <th id="T_acdaa_level0_col3" class="col_heading level0 col3" >pct_growth</th>
      <th id="T_acdaa_level0_col4" class="col_heading level0 col4" >pct_volatility</th>
      <th id="T_acdaa_level0_col5" class="col_heading level0 col5" >rank_avg_sales</th>
      <th id="T_acdaa_level0_col6" class="col_heading level0 col6" >rank_slope</th>
      <th id="T_acdaa_level0_col7" class="col_heading level0 col7" >rank_pct_growth</th>
      <th id="T_acdaa_level0_col8" class="col_heading level0 col8" >rank_volatility</th>
      <th id="T_acdaa_level0_col9" class="col_heading level0 col9" >overall_rank_score</th>
      <th id="T_acdaa_level0_col10" class="col_heading level0 col10" >overall_rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_acdaa_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_acdaa_row0_col0" class="data row0 col0" >1</td>
      <td id="T_acdaa_row0_col1" class="data row0 col1" >1555264</td>
      <td id="T_acdaa_row0_col2" class="data row0 col2" >1127.120000</td>
      <td id="T_acdaa_row0_col3" class="data row0 col3" >10.580000</td>
      <td id="T_acdaa_row0_col4" class="data row0 col4" >26.402651</td>
      <td id="T_acdaa_row0_col5" class="data row0 col5" >9</td>
      <td id="T_acdaa_row0_col6" class="data row0 col6" >5</td>
      <td id="T_acdaa_row0_col7" class="data row0 col7" >12</td>
      <td id="T_acdaa_row0_col8" class="data row0 col8" >35</td>
      <td id="T_acdaa_row0_col9" class="data row0 col9" >9</td>
      <td id="T_acdaa_row0_col10" class="data row0 col10" >7</td>
    </tr>
    <tr>
      <th id="T_acdaa_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_acdaa_row1_col0" class="data row1 col0" >2</td>
      <td id="T_acdaa_row1_col1" class="data row1 col1" >1925751</td>
      <td id="T_acdaa_row1_col2" class="data row1 col2" >-184.000000</td>
      <td id="T_acdaa_row1_col3" class="data row1 col3" >-1.090000</td>
      <td id="T_acdaa_row1_col4" class="data row1 col4" >25.439569</td>
      <td id="T_acdaa_row1_col5" class="data row1 col5" >5</td>
      <td id="T_acdaa_row1_col6" class="data row1 col6" >36</td>
      <td id="T_acdaa_row1_col7" class="data row1 col7" >30</td>
      <td id="T_acdaa_row1_col8" class="data row1 col8" >31</td>
      <td id="T_acdaa_row1_col9" class="data row1 col9" >32</td>
      <td id="T_acdaa_row1_col10" class="data row1 col10" >34</td>
    </tr>
    <tr>
      <th id="T_acdaa_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_acdaa_row2_col0" class="data row2 col0" >3</td>
      <td id="T_acdaa_row2_col1" class="data row2 col1" >402704</td>
      <td id="T_acdaa_row2_col2" class="data row2 col2" >381.560000</td>
      <td id="T_acdaa_row2_col3" class="data row2 col3" >13.390000</td>
      <td id="T_acdaa_row2_col4" class="data row2 col4" >20.941098</td>
      <td id="T_acdaa_row2_col5" class="data row2 col5" >40</td>
      <td id="T_acdaa_row2_col6" class="data row2 col6" >20</td>
      <td id="T_acdaa_row2_col7" class="data row2 col7" >11</td>
      <td id="T_acdaa_row2_col8" class="data row2 col8" >9</td>
      <td id="T_acdaa_row2_col9" class="data row2 col9" >17</td>
      <td id="T_acdaa_row2_col10" class="data row2 col10" >18</td>
    </tr>
    <tr>
      <th id="T_acdaa_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_acdaa_row3_col0" class="data row3 col0" >4</td>
      <td id="T_acdaa_row3_col1" class="data row3 col1" >2094712</td>
      <td id="T_acdaa_row3_col2" class="data row3 col2" >2627.790000</td>
      <td id="T_acdaa_row3_col3" class="data row3 col3" >18.640000</td>
      <td id="T_acdaa_row3_col4" class="data row3 col4" >22.665105</td>
      <td id="T_acdaa_row3_col5" class="data row3 col5" >2</td>
      <td id="T_acdaa_row3_col6" class="data row3 col6" >1</td>
      <td id="T_acdaa_row3_col7" class="data row3 col7" >6</td>
      <td id="T_acdaa_row3_col8" class="data row3 col8" >15</td>
      <td id="T_acdaa_row3_col9" class="data row3 col9" >3</td>
      <td id="T_acdaa_row3_col10" class="data row3 col10" >2</td>
    </tr>
    <tr>
      <th id="T_acdaa_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_acdaa_row4_col0" class="data row4 col0" >5</td>
      <td id="T_acdaa_row4_col1" class="data row4 col1" >318011</td>
      <td id="T_acdaa_row4_col2" class="data row4 col2" >348.750000</td>
      <td id="T_acdaa_row4_col3" class="data row4 col3" >16.090000</td>
      <td id="T_acdaa_row4_col4" class="data row4 col4" >22.180238</td>
      <td id="T_acdaa_row4_col5" class="data row4 col5" >43</td>
      <td id="T_acdaa_row4_col6" class="data row4 col6" >21</td>
      <td id="T_acdaa_row4_col7" class="data row4 col7" >9</td>
      <td id="T_acdaa_row4_col8" class="data row4 col8" >12</td>
      <td id="T_acdaa_row4_col9" class="data row4 col9" >18</td>
      <td id="T_acdaa_row4_col10" class="data row4 col10" >19</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="average-weekly-sales">
<h3>Average Weekly Sales<a class="headerlink" href="#average-weekly-sales" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store_sales_summary</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">performance_df</span><span class="p">[[</span><span class="s1">&#39;avg_sales&#39;</span><span class="p">,</span> <span class="s1">&#39;rank_avg_sales&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">store_sales_summary</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;rank_avg_sales&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">store_sales_summary</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">displayHorizontalDataframes</span><span class="p">(</span>
    <span class="p">[</span><span class="n">store_sales_summary</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">store_sales_summary</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)],</span>
    <span class="p">[</span><span class="s1">&#39;Top 5 Best performing stores&#39;</span><span class="p">,</span> <span class="s1">&#39;Bottom 5 Worst performing stores&#39;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style='display: flex; justify-content: center; align-items: flex-start;'><div style='margin-left: 20px; margin-right: 20px; text-align: center;'><h3>Top 5 Best performing stores</h3><table border="1" class="dataframe dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>avg_sales</th>
      <th>rank_avg_sales</th>
    </tr>
    <tr>
      <th>store</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>20</th>
      <td>2107676</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2094712</td>
      <td>2</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2020978</td>
      <td>3</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2003620</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1925751</td>
      <td>5</td>
    </tr>
  </tbody>
</table></div><div style='margin-left: 20px; margin-right: 20px; text-align: center;'><h3>Bottom 5 Worst performing stores</h3><table border="1" class="dataframe dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>avg_sales</th>
      <th>rank_avg_sales</th>
    </tr>
    <tr>
      <th>store</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>38</th>
      <td>385731</td>
      <td>41</td>
    </tr>
    <tr>
      <th>36</th>
      <td>373511</td>
      <td>42</td>
    </tr>
    <tr>
      <th>5</th>
      <td>318011</td>
      <td>43</td>
    </tr>
    <tr>
      <th>44</th>
      <td>302748</td>
      <td>44</td>
    </tr>
    <tr>
      <th>33</th>
      <td>259861</td>
      <td>45</td>
    </tr>
  </tbody>
</table></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Total sales difference between Top performer and worst performer&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="n">store_sales_summary</span><span class="p">[</span><span class="s1">&#39;avg_sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">store_sales_summary</span><span class="p">[</span><span class="s1">&#39;avg_sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total sales difference between Top performer and worst performer 1847815
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sort stores by average weekly sales descending</span>
<span class="n">sorted_df</span> <span class="o">=</span> <span class="n">store_sales_summary</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;avg_sales&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">sorted_df</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;avg_sales&#39;</span><span class="p">,</span>
    <span class="n">order</span><span class="o">=</span><span class="n">sorted_df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Average Weekly Sales by Store&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/611a1afed0898f413265f62ebb5db3110f547b56fb16ad1c300562eecb8a0e3e.png" src="../_images/611a1afed0898f413265f62ebb5db3110f547b56fb16ad1c300562eecb8a0e3e.png" />
</div>
</div>
</section>
<section id="percentage-growth-in-sales">
<h3>Percentage Growth in Sales<a class="headerlink" href="#percentage-growth-in-sales" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store_sales_summary</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">performance_df</span><span class="p">[[</span><span class="s1">&#39;pct_growth&#39;</span><span class="p">,</span> <span class="s1">&#39;rank_pct_growth&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">store_sales_summary</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;rank_pct_growth&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">store_sales_summary</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">displayHorizontalDataframes</span><span class="p">(</span>
    <span class="p">[</span><span class="n">store_sales_summary</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">store_sales_summary</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)],</span>
    <span class="p">[</span><span class="s1">&#39;Top 5 Best performing stores&#39;</span><span class="p">,</span> <span class="s1">&#39;Bottom 5 Worst performing stores&#39;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style='display: flex; justify-content: center; align-items: flex-start;'><div style='margin-left: 20px; margin-right: 20px; text-align: center;'><h3>Top 5 Best performing stores</h3><table border="1" class="dataframe dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pct_growth</th>
      <th>rank_pct_growth</th>
    </tr>
    <tr>
      <th>store</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>38</th>
      <td>37.19</td>
      <td>1</td>
    </tr>
    <tr>
      <th>39</th>
      <td>26.75</td>
      <td>2</td>
    </tr>
    <tr>
      <th>44</th>
      <td>24.48</td>
      <td>3</td>
    </tr>
    <tr>
      <th>41</th>
      <td>23.13</td>
      <td>4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>21.94</td>
      <td>5</td>
    </tr>
  </tbody>
</table></div><div style='margin-left: 20px; margin-right: 20px; text-align: center;'><h3>Bottom 5 Worst performing stores</h3><table border="1" class="dataframe dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pct_growth</th>
      <th>rank_pct_growth</th>
    </tr>
    <tr>
      <th>store</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>27</th>
      <td>-10.22</td>
      <td>41</td>
    </tr>
    <tr>
      <th>15</th>
      <td>-10.92</td>
      <td>42</td>
    </tr>
    <tr>
      <th>14</th>
      <td>-19.99</td>
      <td>43</td>
    </tr>
    <tr>
      <th>35</th>
      <td>-25.64</td>
      <td>44</td>
    </tr>
    <tr>
      <th>36</th>
      <td>-40.05</td>
      <td>45</td>
    </tr>
  </tbody>
</table></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sort stores by average weekly sales descending</span>
<span class="n">sorted_df</span> <span class="o">=</span> <span class="n">store_sales_summary</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;pct_growth&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">sorted_df</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;pct_growth&#39;</span><span class="p">,</span>
    <span class="n">order</span><span class="o">=</span><span class="n">sorted_df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Percentage Weekly Sales Growth&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1"># plt.grid(True)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fc70ee67fa88e144092069e57b82f9a4084cc5f0883596f8ea4b26e1fa65f644.png" src="../_images/fc70ee67fa88e144092069e57b82f9a4084cc5f0883596f8ea4b26e1fa65f644.png" />
</div>
</div>
</section>
<section id="linear-growth-in-terms-of-trend-of-weekly-sales">
<h3>Linear growth in terms of Trend of Weekly Sales<a class="headerlink" href="#linear-growth-in-terms-of-trend-of-weekly-sales" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store_sales_summary</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">performance_df</span><span class="p">[[</span><span class="s1">&#39;trend_slope&#39;</span><span class="p">,</span> <span class="s1">&#39;rank_slope&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">store_sales_summary</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;rank_slope&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">store_sales_summary</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">displayHorizontalDataframes</span><span class="p">(</span>
    <span class="p">[</span><span class="n">store_sales_summary</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">store_sales_summary</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)],</span>
    <span class="p">[</span><span class="s1">&#39;Top 5 Best performing stores&#39;</span><span class="p">,</span> <span class="s1">&#39;Bottom 5 Worst performing stores&#39;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style='display: flex; justify-content: center; align-items: flex-start;'><div style='margin-left: 20px; margin-right: 20px; text-align: center;'><h3>Top 5 Best performing stores</h3><table border="1" class="dataframe dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>trend_slope</th>
      <th>rank_slope</th>
    </tr>
    <tr>
      <th>store</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>2627.79</td>
      <td>1</td>
    </tr>
    <tr>
      <th>39</th>
      <td>2547.94</td>
      <td>2</td>
    </tr>
    <tr>
      <th>41</th>
      <td>1826.76</td>
      <td>3</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1328.49</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1127.12</td>
      <td>5</td>
    </tr>
  </tbody>
</table></div><div style='margin-left: 20px; margin-right: 20px; text-align: center;'><h3>Bottom 5 Worst performing stores</h3><table border="1" class="dataframe dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>trend_slope</th>
      <th>rank_slope</th>
    </tr>
    <tr>
      <th>store</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>19</th>
      <td>-628.11</td>
      <td>41</td>
    </tr>
    <tr>
      <th>27</th>
      <td>-1311.62</td>
      <td>42</td>
    </tr>
    <tr>
      <th>36</th>
      <td>-1378.94</td>
      <td>43</td>
    </tr>
    <tr>
      <th>35</th>
      <td>-2036.21</td>
      <td>44</td>
    </tr>
    <tr>
      <th>14</th>
      <td>-2814.30</td>
      <td>45</td>
    </tr>
  </tbody>
</table></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sort stores by average weekly sales descending</span>
<span class="n">sorted_df</span> <span class="o">=</span> <span class="n">store_sales_summary</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;trend_slope&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">sorted_df</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;trend_slope&#39;</span><span class="p">,</span>
    <span class="n">order</span><span class="o">=</span><span class="n">sorted_df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Linear growth in terms of Trend of Sales&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1"># plt.grid(True)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/253838cdb028b21dfc1822811db584e02852424f4513ebb480946ac3116ca246.png" src="../_images/253838cdb028b21dfc1822811db584e02852424f4513ebb480946ac3116ca246.png" />
</div>
</div>
</section>
<section id="volatility-of-sales">
<h3>Volatility of Sales<a class="headerlink" href="#volatility-of-sales" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store_sales_summary</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">performance_df</span><span class="p">[[</span><span class="s1">&#39;pct_volatility&#39;</span><span class="p">,</span> <span class="s1">&#39;rank_volatility&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">store_sales_summary</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;rank_volatility&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">store_sales_summary</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">displayHorizontalDataframes</span><span class="p">(</span>
    <span class="p">[</span><span class="n">store_sales_summary</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">store_sales_summary</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)],</span>
    <span class="p">[</span><span class="s1">&#39;Top 5 Best performing stores&#39;</span><span class="p">,</span> <span class="s1">&#39;Bottom 5 Worst performing stores&#39;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style='display: flex; justify-content: center; align-items: flex-start;'><div style='margin-left: 20px; margin-right: 20px; text-align: center;'><h3>Top 5 Best performing stores</h3><table border="1" class="dataframe dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pct_volatility</th>
      <th>rank_volatility</th>
    </tr>
    <tr>
      <th>store</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>18</th>
      <td>15.627316</td>
      <td>1</td>
    </tr>
    <tr>
      <th>20</th>
      <td>19.201057</td>
      <td>2</td>
    </tr>
    <tr>
      <th>39</th>
      <td>19.659181</td>
      <td>3</td>
    </tr>
    <tr>
      <th>25</th>
      <td>20.449854</td>
      <td>4</td>
    </tr>
    <tr>
      <th>10</th>
      <td>20.552056</td>
      <td>5</td>
    </tr>
  </tbody>
</table></div><div style='margin-left: 20px; margin-right: 20px; text-align: center;'><h3>Bottom 5 Worst performing stores</h3><table border="1" class="dataframe dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pct_volatility</th>
      <th>rank_volatility</th>
    </tr>
    <tr>
      <th>store</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>16</th>
      <td>30.215278</td>
      <td>41</td>
    </tr>
    <tr>
      <th>12</th>
      <td>30.694709</td>
      <td>42</td>
    </tr>
    <tr>
      <th>7</th>
      <td>31.261097</td>
      <td>43</td>
    </tr>
    <tr>
      <th>44</th>
      <td>33.493021</td>
      <td>44</td>
    </tr>
    <tr>
      <th>33</th>
      <td>35.770149</td>
      <td>45</td>
    </tr>
  </tbody>
</table></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sort stores by average weekly sales descending</span>
<span class="n">sorted_df</span> <span class="o">=</span> <span class="n">store_sales_summary</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;pct_volatility&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">sorted_df</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;pct_volatility&#39;</span><span class="p">,</span>
    <span class="n">order</span><span class="o">=</span><span class="n">sorted_df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Percentage of weekly sales volatility&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1"># plt.grid(True)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8b4667aadfae16d458b09039906a282c617c0f93369a7d1419e4f620db4d1756.png" src="../_images/8b4667aadfae16d458b09039906a282c617c0f93369a7d1419e4f620db4d1756.png" />
</div>
</div>
</section>
<section id="composite-metric">
<h3>Composite Metric<a class="headerlink" href="#composite-metric" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store_sales_summary</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">performance_df</span><span class="p">[[</span><span class="s1">&#39;overall_rank_score&#39;</span><span class="p">,</span> <span class="s1">&#39;overall_rank&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">store_sales_summary</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;overall_rank&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">store_sales_summary</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">displayHorizontalDataframes</span><span class="p">(</span>
    <span class="p">[</span><span class="n">store_sales_summary</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">store_sales_summary</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)],</span>
    <span class="p">[</span><span class="s1">&#39;Top 5 Best performing stores&#39;</span><span class="p">,</span> <span class="s1">&#39;Bottom 5 Worst performing stores&#39;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style='display: flex; justify-content: center; align-items: flex-start;'><div style='margin-left: 20px; margin-right: 20px; text-align: center;'><h3>Top 5 Best performing stores</h3><table border="1" class="dataframe dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>overall_rank_score</th>
      <th>overall_rank</th>
    </tr>
    <tr>
      <th>store</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>39</th>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>2</td>
    </tr>
    <tr>
      <th>41</th>
      <td>4</td>
      <td>3</td>
    </tr>
    <tr>
      <th>13</th>
      <td>7</td>
      <td>4</td>
    </tr>
    <tr>
      <th>17</th>
      <td>9</td>
      <td>5</td>
    </tr>
  </tbody>
</table></div><div style='margin-left: 20px; margin-right: 20px; text-align: center;'><h3>Bottom 5 Worst performing stores</h3><table border="1" class="dataframe dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>overall_rank_score</th>
      <th>overall_rank</th>
    </tr>
    <tr>
      <th>store</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>27</th>
      <td>38</td>
      <td>41</td>
    </tr>
    <tr>
      <th>15</th>
      <td>39</td>
      <td>42</td>
    </tr>
    <tr>
      <th>14</th>
      <td>40</td>
      <td>43</td>
    </tr>
    <tr>
      <th>35</th>
      <td>42</td>
      <td>44</td>
    </tr>
    <tr>
      <th>36</th>
      <td>42</td>
      <td>45</td>
    </tr>
  </tbody>
</table></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sort stores by average weekly sales descending</span>
<span class="n">sorted_df</span> <span class="o">=</span> <span class="n">store_sales_summary</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;overall_rank_score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">sorted_df</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;overall_rank_score&#39;</span><span class="p">,</span>
    <span class="n">order</span><span class="o">=</span><span class="n">sorted_df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Overall Store-wise Rank Score&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1"># plt.grid(True)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f57e7c907c7c9194a6604cfd62f18de8c3ecc680db1e50ee9fe1e7685774eede.png" src="../_images/f57e7c907c7c9194a6604cfd62f18de8c3ecc680db1e50ee9fe1e7685774eede.png" />
</div>
</div>
</section>
<section id="conclusions">
<h3>Conclusions<a class="headerlink" href="#conclusions" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>By analyzing the composite score rank, stores [39, 4, 41, 13] are the top 5 performers in terms of sales and stores [15, 27, 14, 36, 35] seem to be the worst performers.</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_stores</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;39&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;41&#39;</span><span class="p">,</span> <span class="s1">&#39;13&#39;</span><span class="p">,</span> <span class="s1">&#39;17&#39;</span><span class="p">]</span>
<span class="n">worst_stores</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;36&#39;</span><span class="p">,</span> <span class="s1">&#39;35&#39;</span><span class="p">,</span> <span class="s1">&#39;14&#39;</span><span class="p">,</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span> <span class="s1">&#39;27&#39;</span><span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_store_sales</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">store_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                     <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
  <span class="n">num_stores</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">store_list</span><span class="p">)</span>
  <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
      <span class="n">num_stores</span><span class="p">,</span>
      <span class="mi">1</span><span class="p">,</span>
      <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">num_stores</span><span class="p">),</span> 
      <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 

  <span class="n">colors</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span>
      <span class="s2">&quot;Set1&quot;</span><span class="p">,</span> <span class="n">num_stores</span>
  <span class="p">)</span>  <span class="c1"># Use a visually appealing color palette</span>

  <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">store</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">store_list</span><span class="p">):</span>
    <span class="n">store_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">store_data</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Store </span><span class="si">{</span><span class="n">store</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>  <span class="c1"># Adjust line width for better visibility</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Weekly Sales - Store </span><span class="si">{</span><span class="n">store</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Weekly Sales&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Add grid for easier reading</span>

  <span class="c1"># Customize overall plot appearance</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>  <span class="c1"># Overall title</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Shared x-axis label</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span>
      <span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.92</span><span class="p">]</span>
  <span class="p">)</span>  <span class="c1"># Adjust layout to prevent overlapping titles</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting for best performing stores</span>
<span class="n">plot_store_sales</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">best_stores</span><span class="p">,</span> <span class="s1">&#39;Weekly Sales - Best Performing Stores&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7340d9c3246dd88eddd58eb853ac28cd56997359c1b0eaf48dbc018c0a388a94.png" src="../_images/7340d9c3246dd88eddd58eb853ac28cd56997359c1b0eaf48dbc018c0a388a94.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting for worst performing stores</span>
<span class="n">plot_store_sales</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">worst_stores</span><span class="p">,</span> <span class="s1">&#39;Weekly Sales - Worst Performing Stores&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ee0f89d820eb5542e3170682fd1c86bdb84fa29e6e123e2f960d732b832ca41d.png" src="../_images/ee0f89d820eb5542e3170682fd1c86bdb84fa29e6e123e2f960d732b832ca41d.png" />
</div>
</div>
</section>
</section>
<section id="checking-correlation-between-unemployment-fuel-price-and-cpi">
<h2>Checking correlation between unemployment, fuel_price and cpi<a class="headerlink" href="#checking-correlation-between-unemployment-fuel-price-and-cpi" title="Link to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span>
<span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Create a scatter plot using Matplotlib</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Create a scatter plot</span>
<span class="n">scatter</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;cpi&#39;</span><span class="p">],</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;fuel_price&#39;</span><span class="p">],</span> 
                      <span class="n">c</span><span class="o">=</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;unemployment&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> 
                      <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Add color bar</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scatter</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Unemployment&#39;</span><span class="p">)</span>

<span class="c1"># Add labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Scatter Plot of CPI vs Fuel Price with Unemployment for store &#39;</span> <span class="o">+</span> <span class="n">store</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;CPI&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fuel Price&#39;</span><span class="p">)</span>

<span class="c1"># Adjust layout to avoid overlap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/ebe863cd51f2b34c126973e8583215db9613509d80b5580d7803e0abbd96a75a.png" src="../_images/ebe863cd51f2b34c126973e8583215db9613509d80b5580d7803e0abbd96a75a.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract unique stores</span>
<span class="n">stores</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>  <span class="c1"># Sort for consistent order</span>

<span class="c1"># Initialize correlation storage</span>
<span class="n">unemployment_cpi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="s1">&#39;Kendall&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">stores</span><span class="p">)</span>
<span class="n">cpi_fuel_price</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="s1">&#39;Kendall&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">stores</span><span class="p">)</span>
<span class="n">fuel_price_unemployment</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="s1">&#39;Kendall&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">stores</span><span class="p">)</span>

<span class="c1"># Compute correlations for each store</span>
<span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">stores</span><span class="p">:</span>
    <span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
    
    <span class="c1"># Compute correlations (Unemployment vs CPI)</span>
    <span class="n">unemployment_cpi</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;unemployment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;cpi&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
    <span class="n">unemployment_cpi</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;unemployment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;cpi&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
    <span class="n">unemployment_cpi</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Kendall&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;unemployment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;cpi&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kendall&#39;</span><span class="p">)</span>

    <span class="c1"># Compute correlations (CPI vs Fuel Price)</span>
    <span class="n">cpi_fuel_price</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;cpi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;fuel_price&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
    <span class="n">cpi_fuel_price</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;cpi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;fuel_price&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
    <span class="n">cpi_fuel_price</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Kendall&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;cpi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;fuel_price&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kendall&#39;</span><span class="p">)</span>
    
    <span class="c1"># Compute correlations (Fuel Price vs Unemployment)</span>
    <span class="n">fuel_price_unemployment</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;fuel_price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;unemployment&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
    <span class="n">fuel_price_unemployment</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Spearman&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;fuel_price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;unemployment&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
    <span class="n">fuel_price_unemployment</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Kendall&#39;</span><span class="p">,</span> <span class="n">store</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;fuel_price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;unemployment&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kendall&#39;</span><span class="p">)</span>


<span class="c1"># Convert to float type (for better plotting)</span>
<span class="n">unemployment_cpi</span> <span class="o">=</span> <span class="n">unemployment_cpi</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">cpi_fuel_price</span> <span class="o">=</span> <span class="n">cpi_fuel_price</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">fuel_price_unemployment</span> <span class="o">=</span> <span class="n">fuel_price_unemployment</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>


<span class="c1"># Plot heatmaps</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;height_ratios&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>

<span class="c1"># Unemployment vs cpi Heatmap</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">unemployment_cpi</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Correlation: Unemployment vs cpi&quot;</span><span class="p">)</span>

<span class="c1"># CPI vs fuel_price Heatmap</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cpi_fuel_price</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Correlation: cpi vs fuel_price&quot;</span><span class="p">)</span>

<span class="c1"># Fuel Price vs unemployment Heatmap</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">fuel_price_unemployment</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Correlation: fuel_price vs unemployment&quot;</span><span class="p">)</span>

<span class="c1"># Adjust layout</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/cbf35c102ff72a8d38d0224db9b27d7bc10d0658eaa726d9a0e632801901fef3.png" src="../_images/cbf35c102ff72a8d38d0224db9b27d7bc10d0658eaa726d9a0e632801901fef3.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the extra percentiles you want</span>
<span class="n">extra_percentiles</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]</span>

<span class="c1"># Compute the descriptive statistics including the extra percentiles</span>
<span class="n">desc_unemployment_cpi</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">unemployment_cpi</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Pearson&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="n">extra_percentiles</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Pearson&quot;</span><span class="p">:</span> <span class="s2">&quot;unemployment vs cpi&quot;</span><span class="p">})</span>
<span class="p">)</span>
<span class="n">desc_cpi_fuel_price</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">cpi_fuel_price</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Pearson&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="n">extra_percentiles</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Pearson&quot;</span><span class="p">:</span> <span class="s2">&quot;cpi vs fuel price&quot;</span><span class="p">})</span>
<span class="p">)</span>
<span class="n">desc_fuel_price_unemployment</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">fuel_price_unemployment</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Pearson&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="n">extra_percentiles</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Pearson&quot;</span><span class="p">:</span> <span class="s2">&quot;fuel price vs unemployment&quot;</span><span class="p">})</span>
<span class="p">)</span>

<span class="c1"># Merge the three DataFrames on the &#39;index&#39; column</span>
<span class="p">(</span>
    <span class="n">desc_unemployment_cpi</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">desc_cpi_fuel_price</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">desc_fuel_price_unemployment</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_0a9a0 td {
  font-size: 12.5px;
}
#T_0a9a0  th {
  font-size: 12.5px;
}
</style>
<table id="T_0a9a0">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_0a9a0_level0_col0" class="col_heading level0 col0" >unemployment vs cpi</th>
      <th id="T_0a9a0_level0_col1" class="col_heading level0 col1" >cpi vs fuel price</th>
      <th id="T_0a9a0_level0_col2" class="col_heading level0 col2" >fuel price vs unemployment</th>
    </tr>
    <tr>
      <th class="index_name level0" >index</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_0a9a0_level0_row0" class="row_heading level0 row0" >mean</th>
      <td id="T_0a9a0_row0_col0" class="data row0 col0" >-0.754107</td>
      <td id="T_0a9a0_row0_col1" class="data row0 col1" >0.814384</td>
      <td id="T_0a9a0_row0_col2" class="data row0 col2" >-0.597719</td>
    </tr>
    <tr>
      <th id="T_0a9a0_level0_row1" class="row_heading level0 row1" >std</th>
      <td id="T_0a9a0_row1_col0" class="data row1 col0" >0.374793</td>
      <td id="T_0a9a0_row1_col1" class="data row1 col1" >0.052361</td>
      <td id="T_0a9a0_row1_col2" class="data row1 col2" >0.288258</td>
    </tr>
    <tr>
      <th id="T_0a9a0_level0_row2" class="row_heading level0 row2" >min</th>
      <td id="T_0a9a0_row2_col0" class="data row2 col0" >-0.977855</td>
      <td id="T_0a9a0_row2_col1" class="data row2 col1" >0.754134</td>
      <td id="T_0a9a0_row2_col2" class="data row2 col2" >-0.873024</td>
    </tr>
    <tr>
      <th id="T_0a9a0_level0_row3" class="row_heading level0 row3" >5%</th>
      <td id="T_0a9a0_row3_col0" class="data row3 col0" >-0.974720</td>
      <td id="T_0a9a0_row3_col1" class="data row3 col1" >0.754206</td>
      <td id="T_0a9a0_row3_col2" class="data row3 col2" >-0.851177</td>
    </tr>
    <tr>
      <th id="T_0a9a0_level0_row4" class="row_heading level0 row4" >10%</th>
      <td id="T_0a9a0_row4_col0" class="data row4 col0" >-0.964682</td>
      <td id="T_0a9a0_row4_col1" class="data row4 col1" >0.754895</td>
      <td id="T_0a9a0_row4_col2" class="data row4 col2" >-0.839678</td>
    </tr>
    <tr>
      <th id="T_0a9a0_level0_row5" class="row_heading level0 row5" >15%</th>
      <td id="T_0a9a0_row5_col0" class="data row5 col0" >-0.961946</td>
      <td id="T_0a9a0_row5_col1" class="data row5 col1" >0.755325</td>
      <td id="T_0a9a0_row5_col2" class="data row5 col2" >-0.833261</td>
    </tr>
    <tr>
      <th id="T_0a9a0_level0_row6" class="row_heading level0 row6" >20%</th>
      <td id="T_0a9a0_row6_col0" class="data row6 col0" >-0.961946</td>
      <td id="T_0a9a0_row6_col1" class="data row6 col1" >0.755369</td>
      <td id="T_0a9a0_row6_col2" class="data row6 col2" >-0.795181</td>
    </tr>
    <tr>
      <th id="T_0a9a0_level0_row7" class="row_heading level0 row7" >25%</th>
      <td id="T_0a9a0_row7_col0" class="data row7 col0" >-0.960864</td>
      <td id="T_0a9a0_row7_col1" class="data row7 col1" >0.755861</td>
      <td id="T_0a9a0_row7_col2" class="data row7 col2" >-0.787313</td>
    </tr>
    <tr>
      <th id="T_0a9a0_level0_row8" class="row_heading level0 row8" >50%</th>
      <td id="T_0a9a0_row8_col0" class="data row8 col0" >-0.909667</td>
      <td id="T_0a9a0_row8_col1" class="data row8 col1" >0.809476</td>
      <td id="T_0a9a0_row8_col2" class="data row8 col2" >-0.679553</td>
    </tr>
    <tr>
      <th id="T_0a9a0_level0_row9" class="row_heading level0 row9" >75%</th>
      <td id="T_0a9a0_row9_col0" class="data row9 col0" >-0.732422</td>
      <td id="T_0a9a0_row9_col1" class="data row9 col1" >0.836295</td>
      <td id="T_0a9a0_row9_col2" class="data row9 col2" >-0.538876</td>
    </tr>
    <tr>
      <th id="T_0a9a0_level0_row10" class="row_heading level0 row10" >80%</th>
      <td id="T_0a9a0_row10_col0" class="data row10 col0" >-0.648679</td>
      <td id="T_0a9a0_row10_col1" class="data row10 col1" >0.857948</td>
      <td id="T_0a9a0_row10_col2" class="data row10 col2" >-0.485188</td>
    </tr>
    <tr>
      <th id="T_0a9a0_level0_row11" class="row_heading level0 row11" >85%</th>
      <td id="T_0a9a0_row11_col0" class="data row11 col0" >-0.513644</td>
      <td id="T_0a9a0_row11_col1" class="data row11 col1" >0.859545</td>
      <td id="T_0a9a0_row11_col2" class="data row11 col2" >-0.479774</td>
    </tr>
    <tr>
      <th id="T_0a9a0_level0_row12" class="row_heading level0 row12" >90%</th>
      <td id="T_0a9a0_row12_col0" class="data row12 col0" >-0.231817</td>
      <td id="T_0a9a0_row12_col1" class="data row12 col1" >0.904258</td>
      <td id="T_0a9a0_row12_col2" class="data row12 col2" >-0.384444</td>
    </tr>
    <tr>
      <th id="T_0a9a0_level0_row13" class="row_heading level0 row13" >95%</th>
      <td id="T_0a9a0_row13_col0" class="data row13 col0" >-0.118865</td>
      <td id="T_0a9a0_row13_col1" class="data row13 col1" >0.909358</td>
      <td id="T_0a9a0_row13_col2" class="data row13 col2" >0.066221</td>
    </tr>
    <tr>
      <th id="T_0a9a0_level0_row14" class="row_heading level0 row14" >max</th>
      <td id="T_0a9a0_row14_col0" class="data row14 col0" >0.862500</td>
      <td id="T_0a9a0_row14_col1" class="data row14 col1" >0.910633</td>
      <td id="T_0a9a0_row14_col2" class="data row14 col2" >0.596955</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<section id="id8">
<h3>Observations<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>CPI and Fuel price are strongly positively correlated with each other for ALL stores with average Pearson correlation coefficient of 0.814. This is intuitive because fuel pice is generally considered when calculating CPI.</p></li>
<li><p>Unemployment and CPI are negatively correlated for most stores. For 75% of then stores, the correlation is greater in magnitude than 0.73 and for 85% of the stores it’s greater in magnitude than 0.51. But, for the rest of the stores, the correlation gets closer to zero. And for store 24, the correlation is strongly positive with the coefficient being 0.86</p></li>
<li><p>Fuel Price and Unemployment are negatively correlated for most stores. This correltion isn’t as strong as Unemployment and CPI. For 75% of then stores, the correlation is greater in magnitude than 0.53. But, for the rest of the stores, the correlation gets closer to zero. And for store 24, the correlation is strongly positive with the coefficient being 0.6</p></li>
</ol>
</section>
</section>
<section id="pca-with-cpi-fuel-price-and-unemployment">
<h2>PCA with CPI, Fuel Price, and Unemployment<a class="headerlink" href="#pca-with-cpi-fuel-price-and-unemployment" title="Link to this heading">#</a></h2>
<section id="why">
<h3>Why?<a class="headerlink" href="#why" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>PCA is used for dimensionality reduction. And while it may seem like we don’t have that high dimensional data with only 5 features, but the fact that we are forecasting the sales store wise makes it so that we have only 143 rows/observations per store with 5 features.</p></li>
<li><p>And that’s too little data for us to consider 5 exogenous variables. So we can try to reduce the dimensionality of our data and see if it works.</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import numpy as np</span>
<span class="c1"># import pandas as pd</span>
<span class="c1"># import matplotlib.pyplot as plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.decomposition</span><span class="w"> </span><span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="c1"># 1. Group by store</span>
<span class="n">stores</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="c1"># Let&#39;s create a structure to hold the PCA results for each store</span>
<span class="n">store_pca_results</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">store_id</span> <span class="ow">in</span> <span class="n">stores</span><span class="p">:</span>
    <span class="c1"># Filter data for that store</span>
    <span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store_id</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="c1"># Sort by date to ensure proper time ordering (if not already)</span>
    <span class="n">df_store</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># 2. Extract the 3 correlated features</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[[</span><span class="s1">&#39;cpi&#39;</span><span class="p">,</span> <span class="s1">&#39;fuel_price&#39;</span><span class="p">,</span> <span class="s1">&#39;unemployment&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
    
    <span class="c1"># 3. Standardize the features (very important for PCA!)</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    
    <span class="c1"># 4. Apply PCA</span>
    <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># We&#39;ll fit up to 3, but we might keep fewer</span>
    <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>
    
    <span class="c1"># 5. Get the transformed principal components</span>
    <span class="c1"># shape: (num_weeks, 3)</span>
    <span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>
    
    <span class="c1"># 6. Check explained variance</span>
    <span class="n">explained_variance</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
    
    <span class="c1"># We can store these results</span>
    <span class="n">store_pca_results</span><span class="p">[</span><span class="n">store_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;pca_object&#39;</span><span class="p">:</span> <span class="n">pca</span><span class="p">,</span>
        <span class="s1">&#39;scaler&#39;</span><span class="p">:</span> <span class="n">scaler</span><span class="p">,</span>
        <span class="s1">&#39;explained_variance&#39;</span><span class="p">:</span> <span class="n">explained_variance</span><span class="p">,</span>
        <span class="s1">&#39;principal_components&#39;</span><span class="p">:</span> <span class="n">X_pca</span>
    <span class="p">}</span>

    <span class="c1"># OPTIONAL: You can add these principal components back to df_store</span>
    <span class="c1"># if you want them as features in your next model.</span>
    <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;PC1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_pca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">df_store</span><span class="p">[</span><span class="s1">&#39;PC2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_pca</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="c1"># df_store[&#39;PC3&#39;] = X_pca[:, 2]</span>
    
    <span class="c1"># Then you might store or export df_store with these new columns</span>
    <span class="c1"># e.g., store the modified DataFrame in a dictionary or list</span>
    <span class="n">store_pca_results</span><span class="p">[</span><span class="n">store_id</span><span class="p">][</span><span class="s1">&#39;df_with_pcs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="s2">&quot;10&quot;</span>
<span class="n">df_store</span> <span class="o">=</span> <span class="n">store_pca_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">store</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;df_with_pcs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Define the hue variables</span>
<span class="n">hue_variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cpi&quot;</span><span class="p">,</span> <span class="s2">&quot;unemployment&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel_price&quot;</span><span class="p">]</span>

<span class="c1"># Create subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">hue_variables</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">hue_variables</span><span class="p">)),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># Loop through hue variables and create scatter plots</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">hue_variable</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hue_variables</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># Get the current subplot</span>

    <span class="c1"># Create a scatter plot</span>
    <span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">df_store</span><span class="p">[</span><span class="s2">&quot;PC1&quot;</span><span class="p">],</span>
        <span class="n">df_store</span><span class="p">[</span><span class="s2">&quot;PC2&quot;</span><span class="p">],</span>
        <span class="n">c</span><span class="o">=</span><span class="n">df_store</span><span class="p">[</span><span class="n">hue_variable</span><span class="p">],</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Add color bar</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scatter</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">hue_variable</span><span class="p">)</span>

    <span class="c1"># Add labels and title</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PC1 vs PC2 with </span><span class="si">{</span><span class="n">hue_variable</span><span class="si">}</span><span class="s2"> for store </span><span class="si">{</span><span class="n">store</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;PC2&quot;</span><span class="p">)</span>  <span class="c1"># Y-axis label for each subplot</span>

<span class="c1"># Set common X-axis label for the last subplot</span>
<span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;PC1&quot;</span><span class="p">)</span>

<span class="c1"># Adjust layout to avoid overlap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/3aeed4ecd5e3af29b3a5d784006dafba89c5899fc287a7f3412b0ca435a0b9eb.png" src="../_images/3aeed4ecd5e3af29b3a5d784006dafba89c5899fc287a7f3412b0ca435a0b9eb.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_pcs_time</span><span class="p">(</span><span class="n">store_id</span><span class="p">):</span>
    <span class="n">df_store</span> <span class="o">=</span> <span class="n">store_pca_results</span><span class="p">[</span><span class="n">store_id</span><span class="p">][</span><span class="s2">&quot;df_with_pcs&quot;</span><span class="p">]</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cpi&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel_price&quot;</span><span class="p">,</span> <span class="s2">&quot;unemployment&quot;</span><span class="p">]</span>

    <span class="c1"># Create subplots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Plot PC1 and PC2</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">],</span> <span class="n">df_store</span><span class="p">[</span><span class="s2">&quot;PC1&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;PC1&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">],</span> <span class="n">df_store</span><span class="p">[</span><span class="s2">&quot;PC2&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;PC2&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Principal Components Over Time for Store </span><span class="si">{</span><span class="n">store_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;PC Value&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Plot metrics</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;purple&quot;</span><span class="p">]</span>  <span class="c1"># Define colors for each metric</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metrics</span><span class="p">):</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">],</span> <span class="n">df_store</span><span class="p">[</span><span class="n">metric</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2"> Over Time for Store </span><span class="si">{</span><span class="n">store_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Set x label for the last subplot</span>
    <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">)</span>

    <span class="c1"># Adjust layout and show the plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_pcs_time</span><span class="p">(</span><span class="s2">&quot;10&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/544320441647b439beb2d7f8a576f02cc2b5e9ed1c09d909561b64ff53d321d6.png" src="../_images/544320441647b439beb2d7f8a576f02cc2b5e9ed1c09d909561b64ff53d321d6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pc1_explained_var</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pc2_explained_var</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">store_pca_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pc1_explained_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;explained_variance&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">pc2_explained_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;explained_variance&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

<span class="n">explained_var</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;PC1&#39;</span><span class="p">:</span> <span class="n">pc1_explained_var</span><span class="p">,</span> <span class="s1">&#39;PC2&#39;</span><span class="p">:</span> <span class="n">pc2_explained_var</span><span class="p">})</span>
<span class="n">explained_var</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">explained_var</span><span class="p">[</span><span class="s1">&#39;PC1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">explained_var</span><span class="p">[</span><span class="s1">&#39;PC2&#39;</span><span class="p">]</span>

<span class="n">explained_var</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_194f0 td {
  font-size: 12.5px;
}
#T_194f0  th {
  font-size: 12.5px;
}
</style>
<table id="T_194f0">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_194f0_level0_col0" class="col_heading level0 col0" >PC1</th>
      <th id="T_194f0_level0_col1" class="col_heading level0 col1" >PC2</th>
      <th id="T_194f0_level0_col2" class="col_heading level0 col2" >total</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_194f0_level0_row0" class="row_heading level0 row0" >count</th>
      <td id="T_194f0_row0_col0" class="data row0 col0" >45.000000</td>
      <td id="T_194f0_row0_col1" class="data row0 col1" >45.000000</td>
      <td id="T_194f0_row0_col2" class="data row0 col2" >45.000000</td>
    </tr>
    <tr>
      <th id="T_194f0_level0_row1" class="row_heading level0 row1" >mean</th>
      <td id="T_194f0_row1_col0" class="data row1 col0" >0.837000</td>
      <td id="T_194f0_row1_col1" class="data row1 col1" >0.142385</td>
      <td id="T_194f0_row1_col2" class="data row1 col2" >0.979385</td>
    </tr>
    <tr>
      <th id="T_194f0_level0_row2" class="row_heading level0 row2" >std</th>
      <td id="T_194f0_row2_col0" class="data row2 col0" >0.087777</td>
      <td id="T_194f0_row2_col1" class="data row2 col1" >0.082199</td>
      <td id="T_194f0_row2_col2" class="data row2 col2" >0.015858</td>
    </tr>
    <tr>
      <th id="T_194f0_level0_row3" class="row_heading level0 row3" >min</th>
      <td id="T_194f0_row3_col0" class="data row3 col0" >0.603096</td>
      <td id="T_194f0_row3_col1" class="data row3 col1" >0.056002</td>
      <td id="T_194f0_row3_col2" class="data row3 col2" >0.933382</td>
    </tr>
    <tr>
      <th id="T_194f0_level0_row4" class="row_heading level0 row4" >25%</th>
      <td id="T_194f0_row4_col0" class="data row4 col0" >0.803809</td>
      <td id="T_194f0_row4_col1" class="data row4 col1" >0.087022</td>
      <td id="T_194f0_row4_col2" class="data row4 col2" >0.972884</td>
    </tr>
    <tr>
      <th id="T_194f0_level0_row5" class="row_heading level0 row5" >50%</th>
      <td id="T_194f0_row5_col0" class="data row5 col0" >0.857133</td>
      <td id="T_194f0_row5_col1" class="data row5 col1" >0.135813</td>
      <td id="T_194f0_row5_col2" class="data row5 col2" >0.983690</td>
    </tr>
    <tr>
      <th id="T_194f0_level0_row6" class="row_heading level0 row6" >75%</th>
      <td id="T_194f0_row6_col0" class="data row6 col0" >0.895186</td>
      <td id="T_194f0_row6_col1" class="data row6 col1" >0.158574</td>
      <td id="T_194f0_row6_col2" class="data row6 col2" >0.990703</td>
    </tr>
    <tr>
      <th id="T_194f0_level0_row7" class="row_heading level0 row7" >max</th>
      <td id="T_194f0_row7_col0" class="data row7 col0" >0.934701</td>
      <td id="T_194f0_row7_col1" class="data row7 col1" >0.365466</td>
      <td id="T_194f0_row7_col2" class="data row7 col2" >0.994236</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="conclusion-observations">
<h3>Conclusion/Observations<a class="headerlink" href="#conclusion-observations" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>The 3 features cpi, unemployment and fuel_price are reduced to 2 principal components which on average (across all stores) explains 97% variance across the 3 features.</p></li>
<li><p>The minimum of this total explained various only drops to 93% across all stores. Which is pretty good.</p></li>
<li><p>When I tried reducing the features to just 1 principal component, I got worse results where on average (across all stores) the variance explained was only 83%</p></li>
</ul>
</section>
</section>
<section id="stationarity">
<h2>Stationarity<a class="headerlink" href="#stationarity" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>ADF test</p></li>
<li><p>KPSS test</p></li>
</ul>
<section id="transformations">
<h3>Transformations<a class="headerlink" href="#transformations" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="s1">&#39;16&#39;</span>
<span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">time_series_col</span> <span class="o">=</span> <span class="s1">&#39;weekly_sales&#39;</span>
<span class="n">periods_diff</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Number of times for differencing</span>
<span class="n">window_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>  <span class="c1"># Number of weeks for rolling averages</span>

<span class="c1"># Create difference transformations</span>
<span class="n">df_store</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_series_col</span><span class="si">}</span><span class="s2">_diff_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="n">time_series_col</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_store</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_series_col</span><span class="si">}</span><span class="s2">_diff_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_series_col</span><span class="si">}</span><span class="s2">_diff_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Create rolling average transformations</span>
<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">window_sizes</span><span class="p">:</span>
    <span class="n">df_store</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_series_col</span><span class="si">}</span><span class="s2">_rolling_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">df_store</span><span class="p">[</span><span class="n">time_series_col</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Plotting</span>
<span class="n">num_plots</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">periods_diff</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">window_sizes</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num_plots</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">))</span>  <span class="c1"># Adjusted figsize</span>

<span class="c1"># Plot original time series</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_store</span><span class="p">[</span><span class="n">time_series_col</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">time_series_col</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original Time Series: </span><span class="si">{</span><span class="n">time_series_col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># Plot difference transformations</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">periods_diff</span><span class="p">):</span>
    <span class="n">col_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_series_col</span><span class="si">}</span><span class="s2">_diff_</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_store</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_store</span><span class="p">[</span><span class="n">col_name</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">col_name</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Difference (Period </span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2"> Weeks)&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot rolling average transformations</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">window</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">window_sizes</span><span class="p">):</span>
    <span class="n">col_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_series_col</span><span class="si">}</span><span class="s2">_rolling_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">axes</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">periods_diff</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">df_store</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_store</span><span class="p">[</span><span class="n">col_name</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">col_name</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">periods_diff</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Rolling Average (Window </span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2"> Weeks)&quot;</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">periods_diff</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">periods_diff</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/6a559af0305470f1972d20df154ca686bb7ac278c54e2f9ac2bab55d51821ebb.png" src="../_images/6a559af0305470f1972d20df154ca686bb7ac278c54e2f9ac2bab55d51821ebb.png" />
</div>
</div>
<section id="id9">
<h4>Observations<a class="headerlink" href="#id9" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>From manual inspection atleast, 1st and 2nd differencing make the series mostly stationary. However, the holiday effect is still present.</p></li>
<li><p>Rolling averages are not helping much.</p></li>
</ul>
</section>
</section>
<section id="seasonal-decomposition-of-differences">
<h3>Seasonal Decomposition of Differences<a class="headerlink" href="#seasonal-decomposition-of-differences" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
<span class="n">df_store</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_store</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">time_series_col</span> <span class="o">=</span> <span class="s1">&#39;weekly_sales&#39;</span>
<span class="n">periods_diff</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Number of weeks for differencing</span>
<span class="n">window_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>  <span class="c1"># Number of weeks for rolling averages</span>

<span class="c1"># Create difference transformations</span>
<span class="n">df_store</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_series_col</span><span class="si">}</span><span class="s2">_diff_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="n">time_series_col</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_store</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_series_col</span><span class="si">}</span><span class="s2">_diff_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_series_col</span><span class="si">}</span><span class="s2">_diff_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Create rolling average transformations</span>
<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">window_sizes</span><span class="p">:</span>
    <span class="n">df_store</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_series_col</span><span class="si">}</span><span class="s2">_rolling_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">df_store</span><span class="p">[</span><span class="n">time_series_col</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">df_store</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_series_col</span><span class="si">}</span><span class="s2">_diff_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># We assume an annual (52-week) seasonal period</span>
<span class="n">stl</span> <span class="o">=</span> <span class="n">STL</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">52</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">stl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/f9de51458086340d2440994da4725c6f6474d32a5632fc71c57ac07e814cbdaa.png" src="../_images/f9de51458086340d2440994da4725c6f6474d32a5632fc71c57ac07e814cbdaa.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mstl</span> <span class="o">=</span> <span class="n">MSTL</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">52</span><span class="p">],</span> <span class="n">iterate</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">mstl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/311627d670de1fc8a526d02412f94e6463833147245cdf322a8340f3b6b018f7.png" src="../_images/311627d670de1fc8a526d02412f94e6463833147245cdf322a8340f3b6b018f7.png" />
</div>
</div>
<section id="id10">
<h4>Observations<a class="headerlink" href="#id10" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>STL decomposition of diff 1 shows good results. It may look like there’s a trend, but comparing it’s range to the range of sales diff 1, it is insignificant.</p></li>
<li><p>MSTL would have been promising for seasonal periods of 5 (1 month) and 52 weeks (1 year). But, since our years are not fully divisible into whole weeks, it is difficult to capture seasonality. Same for monthly seasonality.</p></li>
</ul>
</section>
</section>
<section id="seasonal-differencing">
<h3>Seasonal Differencing<a class="headerlink" href="#seasonal-differencing" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store_number</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>

<span class="n">store_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;store&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store_number</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">store_df</span> <span class="o">=</span> <span class="n">store_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
<span class="n">store_df</span><span class="p">[</span><span class="s2">&quot;seasonal_diff_52&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">store_df</span><span class="p">[</span><span class="s2">&quot;weekly_sales&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">52</span><span class="p">)</span>
<span class="n">store_df</span><span class="p">[</span><span class="s2">&quot;seasonal_diff_53&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">store_df</span><span class="p">[</span><span class="s2">&quot;weekly_sales&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">53</span><span class="p">)</span>

<span class="c1"># Define dark blue color</span>
<span class="n">dark_blue</span> <span class="o">=</span> <span class="s2">&quot;#00008B&quot;</span>

<span class="c1"># Create subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Function to add holiday annotations</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_holiday_annotations</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
    <span class="n">holiday_dates</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;holiday_flag&quot;</span><span class="p">],</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">holiday_dates</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Holiday&quot;</span> <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="n">holiday_dates</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>


<span class="c1"># Plot original weekly sales</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;weekly_sales&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">store_df</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Weekly Sales&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">add_holiday_annotations</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">store_df</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weekly Sales for Store </span><span class="si">{</span><span class="n">store_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Sales&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>


<span class="c1"># Plot seasonal difference (52 weeks)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;seasonal_diff_52&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">store_df</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Seasonal Difference (52 weeks)&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">add_holiday_annotations</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">store_df</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Seasonal Difference (52 weeks) for Store </span><span class="si">{</span><span class="n">store_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Sales Difference&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Plot seasonal difference (53 weeks)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;seasonal_diff_53&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">store_df</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Seasonal Difference (53 weeks)&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">add_holiday_annotations</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">store_df</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Seasonal Difference (53 weeks) for Store </span><span class="si">{</span><span class="n">store_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Sales Difference&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Adjust layout to prevent labels from overlapping</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/0f98760f7e1b13b2261ae52cc2a34d0a5ec952eae643fc6745df75902cde3b22.png" src="../_images/0f98760f7e1b13b2261ae52cc2a34d0a5ec952eae643fc6745df75902cde3b22.png" />
</div>
</div>
<section id="id11">
<h4>Observations<a class="headerlink" href="#id11" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Holidays in this case repeat every 365 days (a year). But, unfortunately, we have weekly data and can only use 52 or 53 weeks for differencing instead of something like 52.5 days which would be 1 proper year.</p></li>
<li><p>That’s why, we can observe few peculiarities: for some holidays, the 52 week differencing nullifies the holiday effect boost (excluding the general updards trend ofcourse) and for the rest, it doesn’t nullify the effect due to reasons mentioned in previous point.</p></li>
<li><p>Same for 53 weeks differencing. For some holidays, it nullifies the holiday effect boost and for the rest, it doesn’t.</p></li>
</ul>
</section>
</section>
<section id="adf-and-kpss-test-for-stationarity">
<h3>ADF and KPSS test for stationarity<a class="headerlink" href="#adf-and-kpss-test-for-stationarity" title="Link to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.stattools</span><span class="w"> </span><span class="kn">import</span> <span class="n">adfuller</span><span class="p">,</span> <span class="n">kpss</span>

<span class="c1"># Define helper functions for ADF and KPSS tests</span>
<span class="k">def</span><span class="w"> </span><span class="nf">run_adf</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;adf_stat&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;p_value&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;n_lags&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="s2">&quot;n_obs&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="s2">&quot;crit_1%&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;1%&quot;</span><span class="p">),</span>
        <span class="s2">&quot;crit_5%&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;5%&quot;</span><span class="p">),</span>
        <span class="s2">&quot;crit_10%&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;10%&quot;</span><span class="p">),</span>
        <span class="s2">&quot;ic_best&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># information criterion used for lag selection</span>
    <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_kpss</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">kpss</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="n">regression</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;kpss_stat&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;p_value&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;n_lags&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="s2">&quot;crit_10%&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;10%&quot;</span><span class="p">),</span>
        <span class="s2">&quot;crit_5%&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;5%&quot;</span><span class="p">),</span>
        <span class="s2">&quot;crit_2.5%&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;2.5%&quot;</span><span class="p">),</span>
        <span class="s2">&quot;crit_1%&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;1%&quot;</span><span class="p">)</span>
    <span class="p">}</span>

<span class="c1"># Containers for storing results for each test and differencing order</span>
<span class="n">adf_diff1_results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">adf_diff2_results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">kpss_diff1_results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">kpss_diff2_results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;store&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">:</span>
    <span class="c1"># Subset data for the store and sort by date</span>
    <span class="n">store_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;store&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
    <span class="n">sales_series</span> <span class="o">=</span> <span class="n">store_data</span><span class="p">[</span><span class="s2">&quot;weekly_sales&quot;</span><span class="p">]</span>

    <span class="c1"># Compute first and second differences (drop the NaN at the beginning)</span>
    <span class="n">diff1</span> <span class="o">=</span> <span class="n">sales_series</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">diff2</span> <span class="o">=</span> <span class="n">sales_series</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

    <span class="c1"># Run tests and capture the results.</span>
    <span class="c1"># Using try/except to catch any errors (e.g., if the series is too short)</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
        <span class="n">adf_res1</span> <span class="o">=</span> <span class="n">run_adf</span><span class="p">(</span><span class="n">diff1</span><span class="p">)</span>
        <span class="n">adf_res2</span> <span class="o">=</span> <span class="n">run_adf</span><span class="p">(</span><span class="n">diff2</span><span class="p">)</span>
        <span class="n">kpss_res1</span> <span class="o">=</span> <span class="n">run_kpss</span><span class="p">(</span><span class="n">diff1</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
        <span class="n">kpss_res2</span> <span class="o">=</span> <span class="n">run_kpss</span><span class="p">(</span><span class="n">diff2</span><span class="p">,</span> <span class="n">regression</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>

    <span class="c1"># Add a reference to the store (to facilitate grouping later)</span>
    <span class="n">adf_res1</span><span class="p">[</span><span class="s2">&quot;store&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">store</span>
    <span class="n">adf_res2</span><span class="p">[</span><span class="s2">&quot;store&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">store</span>
    <span class="n">kpss_res1</span><span class="p">[</span><span class="s2">&quot;store&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">store</span>
    <span class="n">kpss_res2</span><span class="p">[</span><span class="s2">&quot;store&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">store</span>

    <span class="n">adf_diff1_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res1</span><span class="p">)</span>
    <span class="n">adf_diff2_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res2</span><span class="p">)</span>
    <span class="n">kpss_diff1_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res1</span><span class="p">)</span>
    <span class="n">kpss_diff2_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res2</span><span class="p">)</span>

<span class="c1"># Create DataFrames (using store as index)</span>
<span class="n">adf_diff1_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">adf_diff1_results</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;store&quot;</span><span class="p">)</span>
<span class="n">adf_diff2_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">adf_diff2_results</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;store&quot;</span><span class="p">)</span>
<span class="n">kpss_diff1_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">kpss_diff1_results</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;store&quot;</span><span class="p">)</span>
<span class="n">kpss_diff2_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">kpss_diff2_results</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;store&quot;</span><span class="p">)</span>

<span class="c1"># Get descriptive summaries for each test and differencing order.</span>
<span class="c1"># The describe() output uses as index: count, mean, std, min, 25%, 50%, 75%, max.</span>
<span class="n">adf_diff1_summary</span> <span class="o">=</span> <span class="n">adf_diff1_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">adf_diff2_summary</span> <span class="o">=</span> <span class="n">adf_diff2_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">kpss_diff1_summary</span> <span class="o">=</span> <span class="n">kpss_diff1_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">kpss_diff2_summary</span> <span class="o">=</span> <span class="n">kpss_diff2_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<section id="adf-for-1st-order-differences">
<h4>ADF for 1st order differences<a class="headerlink" href="#adf-for-1st-order-differences" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_diff1_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_7ff4e td {
  font-size: 12.5px;
}
#T_7ff4e  th {
  font-size: 12.5px;
}
</style>
<table id="T_7ff4e">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_7ff4e_level0_col0" class="col_heading level0 col0" >adf_stat</th>
      <th id="T_7ff4e_level0_col1" class="col_heading level0 col1" >p_value</th>
      <th id="T_7ff4e_level0_col2" class="col_heading level0 col2" >n_lags</th>
      <th id="T_7ff4e_level0_col3" class="col_heading level0 col3" >n_obs</th>
      <th id="T_7ff4e_level0_col4" class="col_heading level0 col4" >crit_1%</th>
      <th id="T_7ff4e_level0_col5" class="col_heading level0 col5" >crit_5%</th>
      <th id="T_7ff4e_level0_col6" class="col_heading level0 col6" >crit_10%</th>
      <th id="T_7ff4e_level0_col7" class="col_heading level0 col7" >ic_best</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_7ff4e_level0_row0" class="row_heading level0 row0" >count</th>
      <td id="T_7ff4e_row0_col0" class="data row0 col0" >45.000000</td>
      <td id="T_7ff4e_row0_col1" class="data row0 col1" >45.000000</td>
      <td id="T_7ff4e_row0_col2" class="data row0 col2" >45.000000</td>
      <td id="T_7ff4e_row0_col3" class="data row0 col3" >45.000000</td>
      <td id="T_7ff4e_row0_col4" class="data row0 col4" >45.000000</td>
      <td id="T_7ff4e_row0_col5" class="data row0 col5" >45.000000</td>
      <td id="T_7ff4e_row0_col6" class="data row0 col6" >45.000000</td>
      <td id="T_7ff4e_row0_col7" class="data row0 col7" >45.000000</td>
    </tr>
    <tr>
      <th id="T_7ff4e_level0_row1" class="row_heading level0 row1" >mean</th>
      <td id="T_7ff4e_row1_col0" class="data row1 col0" >-6.888685</td>
      <td id="T_7ff4e_row1_col1" class="data row1 col1" >0.000164</td>
      <td id="T_7ff4e_row1_col2" class="data row1 col2" >6.733333</td>
      <td id="T_7ff4e_row1_col3" class="data row1 col3" >134.266667</td>
      <td id="T_7ff4e_row1_col4" class="data row1 col4" >-3.480035</td>
      <td id="T_7ff4e_row1_col5" class="data row1 col5" >-2.883326</td>
      <td id="T_7ff4e_row1_col6" class="data row1 col6" >-2.578388</td>
      <td id="T_7ff4e_row1_col7" class="data row1 col7" >3278.859720</td>
    </tr>
    <tr>
      <th id="T_7ff4e_level0_row2" class="row_heading level0 row2" >std</th>
      <td id="T_7ff4e_row2_col0" class="data row2 col0" >1.601953</td>
      <td id="T_7ff4e_row2_col1" class="data row2 col1" >0.000525</td>
      <td id="T_7ff4e_row2_col2" class="data row2 col2" >2.480836</td>
      <td id="T_7ff4e_row2_col3" class="data row2 col3" >2.480836</td>
      <td id="T_7ff4e_row2_col4" class="data row2 col4" >0.000956</td>
      <td id="T_7ff4e_row2_col5" class="data row2 col5" >0.000416</td>
      <td id="T_7ff4e_row2_col6" class="data row2 col6" >0.000222</td>
      <td id="T_7ff4e_row2_col7" class="data row2 col7" >231.917915</td>
    </tr>
    <tr>
      <th id="T_7ff4e_level0_row3" class="row_heading level0 row3" >min</th>
      <td id="T_7ff4e_row3_col0" class="data row3 col0" >-13.345453</td>
      <td id="T_7ff4e_row3_col1" class="data row3 col1" >0.000000</td>
      <td id="T_7ff4e_row3_col2" class="data row3 col2" >2.000000</td>
      <td id="T_7ff4e_row3_col3" class="data row3 col3" >127.000000</td>
      <td id="T_7ff4e_row3_col4" class="data row3 col4" >-3.482920</td>
      <td id="T_7ff4e_row3_col5" class="data row3 col5" >-2.884580</td>
      <td id="T_7ff4e_row3_col6" class="data row3 col6" >-2.579058</td>
      <td id="T_7ff4e_row3_col7" class="data row3 col7" >2725.440942</td>
    </tr>
    <tr>
      <th id="T_7ff4e_level0_row4" class="row_heading level0 row4" >25%</th>
      <td id="T_7ff4e_row4_col0" class="data row4 col0" >-7.487731</td>
      <td id="T_7ff4e_row4_col1" class="data row4 col1" >0.000000</td>
      <td id="T_7ff4e_row4_col2" class="data row4 col2" >5.000000</td>
      <td id="T_7ff4e_row4_col3" class="data row4 col3" >134.000000</td>
      <td id="T_7ff4e_row4_col4" class="data row4 col4" >-3.480119</td>
      <td id="T_7ff4e_row4_col5" class="data row4 col5" >-2.883362</td>
      <td id="T_7ff4e_row4_col6" class="data row4 col6" >-2.578407</td>
      <td id="T_7ff4e_row4_col7" class="data row4 col7" >3208.775174</td>
    </tr>
    <tr>
      <th id="T_7ff4e_level0_row5" class="row_heading level0 row5" >50%</th>
      <td id="T_7ff4e_row5_col0" class="data row5 col0" >-7.053856</td>
      <td id="T_7ff4e_row5_col1" class="data row5 col1" >0.000000</td>
      <td id="T_7ff4e_row5_col2" class="data row5 col2" >7.000000</td>
      <td id="T_7ff4e_row5_col3" class="data row5 col3" >134.000000</td>
      <td id="T_7ff4e_row5_col4" class="data row5 col4" >-3.480119</td>
      <td id="T_7ff4e_row5_col5" class="data row5 col5" >-2.883362</td>
      <td id="T_7ff4e_row5_col6" class="data row5 col6" >-2.578407</td>
      <td id="T_7ff4e_row5_col7" class="data row5 col7" >3339.947073</td>
    </tr>
    <tr>
      <th id="T_7ff4e_level0_row6" class="row_heading level0 row6" >75%</th>
      <td id="T_7ff4e_row6_col0" class="data row6 col0" >-6.567946</td>
      <td id="T_7ff4e_row6_col1" class="data row6 col1" >0.000000</td>
      <td id="T_7ff4e_row6_col2" class="data row6 col2" >7.000000</td>
      <td id="T_7ff4e_row6_col3" class="data row6 col3" >136.000000</td>
      <td id="T_7ff4e_row6_col4" class="data row6 col4" >-3.479372</td>
      <td id="T_7ff4e_row6_col5" class="data row6 col5" >-2.883037</td>
      <td id="T_7ff4e_row6_col6" class="data row6 col6" >-2.578234</td>
      <td id="T_7ff4e_row6_col7" class="data row6 col7" >3428.869715</td>
    </tr>
    <tr>
      <th id="T_7ff4e_level0_row7" class="row_heading level0 row7" >max</th>
      <td id="T_7ff4e_row7_col0" class="data row7 col0" >-3.812654</td>
      <td id="T_7ff4e_row7_col1" class="data row7 col1" >0.002780</td>
      <td id="T_7ff4e_row7_col2" class="data row7 col2" >14.000000</td>
      <td id="T_7ff4e_row7_col3" class="data row7 col3" >139.000000</td>
      <td id="T_7ff4e_row7_col4" class="data row7 col4" >-3.478294</td>
      <td id="T_7ff4e_row7_col5" class="data row7 col5" >-2.882568</td>
      <td id="T_7ff4e_row7_col6" class="data row7 col6" >-2.577983</td>
      <td id="T_7ff4e_row7_col7" class="data row7 col7" >3544.995400</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<section id="id12">
<h5>Observations<a class="headerlink" href="#id12" title="Link to this heading">#</a></h5>
<ul class="simple">
<li><p>Maximum p-value for the storewise sales is &lt; 0.0027 which is obviously very low than the 0.05 threshold.</p></li>
<li><p>The max ADF statistic value is lower than the minimum value of 5% critical value. That implies, for ALL stores, the ADF test statistic is less than 5% critical value.</p></li>
<li><p>Hence, for 1st order differencing, we can confidently reject the null hypothesis that the series is non-stationary for all stores.</p></li>
</ul>
</section>
</section>
<section id="adf-for-2nd-order-differences">
<h4>ADF for 2nd order differences<a class="headerlink" href="#adf-for-2nd-order-differences" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_diff2_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_0c37a td {
  font-size: 12.5px;
}
#T_0c37a  th {
  font-size: 12.5px;
}
</style>
<table id="T_0c37a">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_0c37a_level0_col0" class="col_heading level0 col0" >adf_stat</th>
      <th id="T_0c37a_level0_col1" class="col_heading level0 col1" >p_value</th>
      <th id="T_0c37a_level0_col2" class="col_heading level0 col2" >n_lags</th>
      <th id="T_0c37a_level0_col3" class="col_heading level0 col3" >n_obs</th>
      <th id="T_0c37a_level0_col4" class="col_heading level0 col4" >crit_1%</th>
      <th id="T_0c37a_level0_col5" class="col_heading level0 col5" >crit_5%</th>
      <th id="T_0c37a_level0_col6" class="col_heading level0 col6" >crit_10%</th>
      <th id="T_0c37a_level0_col7" class="col_heading level0 col7" >ic_best</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_0c37a_level0_row0" class="row_heading level0 row0" >count</th>
      <td id="T_0c37a_row0_col0" class="data row0 col0" >45.000000</td>
      <td id="T_0c37a_row0_col1" class="data row0 col1" >45.000000</td>
      <td id="T_0c37a_row0_col2" class="data row0 col2" >45.000000</td>
      <td id="T_0c37a_row0_col3" class="data row0 col3" >45.000000</td>
      <td id="T_0c37a_row0_col4" class="data row0 col4" >45.000000</td>
      <td id="T_0c37a_row0_col5" class="data row0 col5" >45.000000</td>
      <td id="T_0c37a_row0_col6" class="data row0 col6" >45.000000</td>
      <td id="T_0c37a_row0_col7" class="data row0 col7" >45.000000</td>
    </tr>
    <tr>
      <th id="T_0c37a_level0_row1" class="row_heading level0 row1" >mean</th>
      <td id="T_0c37a_row1_col0" class="data row1 col0" >-5.915064</td>
      <td id="T_0c37a_row1_col1" class="data row1 col1" >0.006170</td>
      <td id="T_0c37a_row1_col2" class="data row1 col2" >8.022222</td>
      <td id="T_0c37a_row1_col3" class="data row1 col3" >131.977778</td>
      <td id="T_0c37a_row1_col4" class="data row1 col4" >-3.480935</td>
      <td id="T_0c37a_row1_col5" class="data row1 col5" >-2.883717</td>
      <td id="T_0c37a_row1_col6" class="data row1 col6" >-2.578597</td>
      <td id="T_0c37a_row1_col7" class="data row1 col7" >3262.797691</td>
    </tr>
    <tr>
      <th id="T_0c37a_level0_row2" class="row_heading level0 row2" >std</th>
      <td id="T_0c37a_row2_col0" class="data row2 col0" >1.421504</td>
      <td id="T_0c37a_row2_col1" class="data row2 col1" >0.025940</td>
      <td id="T_0c37a_row2_col2" class="data row2 col2" >3.602328</td>
      <td id="T_0c37a_row2_col3" class="data row2 col3" >3.602328</td>
      <td id="T_0c37a_row2_col4" class="data row2 col4" >0.001408</td>
      <td id="T_0c37a_row2_col5" class="data row2 col5" >0.000612</td>
      <td id="T_0c37a_row2_col6" class="data row2 col6" >0.000327</td>
      <td id="T_0c37a_row2_col7" class="data row2 col7" >228.548549</td>
    </tr>
    <tr>
      <th id="T_0c37a_level0_row3" class="row_heading level0 row3" >min</th>
      <td id="T_0c37a_row3_col0" class="data row3 col0" >-8.678118</td>
      <td id="T_0c37a_row3_col1" class="data row3 col1" >0.000000</td>
      <td id="T_0c37a_row3_col2" class="data row3 col2" >2.000000</td>
      <td id="T_0c37a_row3_col3" class="data row3 col3" >126.000000</td>
      <td id="T_0c37a_row3_col4" class="data row3 col4" >-3.483346</td>
      <td id="T_0c37a_row3_col5" class="data row3 col5" >-2.884766</td>
      <td id="T_0c37a_row3_col6" class="data row3 col6" >-2.579156</td>
      <td id="T_0c37a_row3_col7" class="data row3 col7" >2720.287960</td>
    </tr>
    <tr>
      <th id="T_0c37a_level0_row4" class="row_heading level0 row4" >25%</th>
      <td id="T_0c37a_row4_col0" class="data row4 col0" >-7.143230</td>
      <td id="T_0c37a_row4_col1" class="data row4 col1" >0.000000</td>
      <td id="T_0c37a_row4_col2" class="data row4 col2" >5.000000</td>
      <td id="T_0c37a_row4_col3" class="data row4 col3" >129.000000</td>
      <td id="T_0c37a_row4_col4" class="data row4 col4" >-3.482088</td>
      <td id="T_0c37a_row4_col5" class="data row4 col5" >-2.884219</td>
      <td id="T_0c37a_row4_col6" class="data row4 col6" >-2.578864</td>
      <td id="T_0c37a_row4_col7" class="data row4 col7" >3192.138229</td>
    </tr>
    <tr>
      <th id="T_0c37a_level0_row5" class="row_heading level0 row5" >50%</th>
      <td id="T_0c37a_row5_col0" class="data row5 col0" >-5.806791</td>
      <td id="T_0c37a_row5_col1" class="data row5 col1" >0.000000</td>
      <td id="T_0c37a_row5_col2" class="data row5 col2" >9.000000</td>
      <td id="T_0c37a_row5_col3" class="data row5 col3" >131.000000</td>
      <td id="T_0c37a_row5_col4" class="data row5 col4" >-3.481282</td>
      <td id="T_0c37a_row5_col5" class="data row5 col5" >-2.883868</td>
      <td id="T_0c37a_row5_col6" class="data row5 col6" >-2.578677</td>
      <td id="T_0c37a_row5_col7" class="data row5 col7" >3324.474716</td>
    </tr>
    <tr>
      <th id="T_0c37a_level0_row6" class="row_heading level0 row6" >75%</th>
      <td id="T_0c37a_row6_col0" class="data row6 col0" >-5.132804</td>
      <td id="T_0c37a_row6_col1" class="data row6 col1" >0.000012</td>
      <td id="T_0c37a_row6_col2" class="data row6 col2" >11.000000</td>
      <td id="T_0c37a_row6_col3" class="data row6 col3" >135.000000</td>
      <td id="T_0c37a_row6_col4" class="data row6 col4" >-3.479743</td>
      <td id="T_0c37a_row6_col5" class="data row6 col5" >-2.883198</td>
      <td id="T_0c37a_row6_col6" class="data row6 col6" >-2.578320</td>
      <td id="T_0c37a_row6_col7" class="data row6 col7" >3412.071615</td>
    </tr>
    <tr>
      <th id="T_0c37a_level0_row7" class="row_heading level0 row7" >max</th>
      <td id="T_0c37a_row7_col0" class="data row7 col0" >-2.333016</td>
      <td id="T_0c37a_row7_col1" class="data row7 col1" >0.161541</td>
      <td id="T_0c37a_row7_col2" class="data row7 col2" >14.000000</td>
      <td id="T_0c37a_row7_col3" class="data row7 col3" >138.000000</td>
      <td id="T_0c37a_row7_col4" class="data row7 col4" >-3.478648</td>
      <td id="T_0c37a_row7_col5" class="data row7 col5" >-2.882722</td>
      <td id="T_0c37a_row7_col6" class="data row7 col6" >-2.578065</td>
      <td id="T_0c37a_row7_col7" class="data row7 col7" >3525.435008</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_diff2_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adf_diff2_df</span><span class="p">[</span><span class="s1">&#39;p_value&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_1d34d td {
  font-size: 12.5px;
}
#T_1d34d  th {
  font-size: 12.5px;
}
</style>
<table id="T_1d34d">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_1d34d_level0_col0" class="col_heading level0 col0" >adf_stat</th>
      <th id="T_1d34d_level0_col1" class="col_heading level0 col1" >p_value</th>
      <th id="T_1d34d_level0_col2" class="col_heading level0 col2" >n_lags</th>
      <th id="T_1d34d_level0_col3" class="col_heading level0 col3" >n_obs</th>
      <th id="T_1d34d_level0_col4" class="col_heading level0 col4" >crit_1%</th>
      <th id="T_1d34d_level0_col5" class="col_heading level0 col5" >crit_5%</th>
      <th id="T_1d34d_level0_col6" class="col_heading level0 col6" >crit_10%</th>
      <th id="T_1d34d_level0_col7" class="col_heading level0 col7" >ic_best</th>
    </tr>
    <tr>
      <th class="index_name level0" >store</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
      <th class="blank col6" >&nbsp;</th>
      <th class="blank col7" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_1d34d_level0_row0" class="row_heading level0 row0" >33</th>
      <td id="T_1d34d_row0_col0" class="data row0 col0" >-2.816371</td>
      <td id="T_1d34d_row0_col1" class="data row0 col1" >0.055973</td>
      <td id="T_1d34d_row0_col2" class="data row0 col2" >13</td>
      <td id="T_1d34d_row0_col3" class="data row0 col3" >127</td>
      <td id="T_1d34d_row0_col4" class="data row0 col4" >-3.482920</td>
      <td id="T_1d34d_row0_col5" class="data row0 col5" >-2.884580</td>
      <td id="T_1d34d_row0_col6" class="data row0 col6" >-2.579058</td>
      <td id="T_1d34d_row0_col7" class="data row0 col7" >2720.287960</td>
    </tr>
    <tr>
      <th id="T_1d34d_level0_row1" class="row_heading level0 row1" >38</th>
      <td id="T_1d34d_row1_col0" class="data row1 col0" >-2.333016</td>
      <td id="T_1d34d_row1_col1" class="data row1 col1" >0.161541</td>
      <td id="T_1d34d_row1_col2" class="data row1 col2" >14</td>
      <td id="T_1d34d_row1_col3" class="data row1 col3" >126</td>
      <td id="T_1d34d_row1_col4" class="data row1 col4" >-3.483346</td>
      <td id="T_1d34d_row1_col5" class="data row1 col5" >-2.884766</td>
      <td id="T_1d34d_row1_col6" class="data row1 col6" >-2.579156</td>
      <td id="T_1d34d_row1_col7" class="data row1 col7" >2848.628100</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_diff2_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adf_diff2_df</span><span class="p">[</span><span class="s1">&#39;adf_stat&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">adf_diff2_df</span><span class="p">[</span><span class="s1">&#39;crit_5%&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_bdbc2 td {
  font-size: 12.5px;
}
#T_bdbc2  th {
  font-size: 12.5px;
}
</style>
<table id="T_bdbc2">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_bdbc2_level0_col0" class="col_heading level0 col0" >adf_stat</th>
      <th id="T_bdbc2_level0_col1" class="col_heading level0 col1" >p_value</th>
      <th id="T_bdbc2_level0_col2" class="col_heading level0 col2" >n_lags</th>
      <th id="T_bdbc2_level0_col3" class="col_heading level0 col3" >n_obs</th>
      <th id="T_bdbc2_level0_col4" class="col_heading level0 col4" >crit_1%</th>
      <th id="T_bdbc2_level0_col5" class="col_heading level0 col5" >crit_5%</th>
      <th id="T_bdbc2_level0_col6" class="col_heading level0 col6" >crit_10%</th>
      <th id="T_bdbc2_level0_col7" class="col_heading level0 col7" >ic_best</th>
    </tr>
    <tr>
      <th class="index_name level0" >store</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
      <th class="blank col6" >&nbsp;</th>
      <th class="blank col7" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_bdbc2_level0_row0" class="row_heading level0 row0" >33</th>
      <td id="T_bdbc2_row0_col0" class="data row0 col0" >-2.816371</td>
      <td id="T_bdbc2_row0_col1" class="data row0 col1" >0.055973</td>
      <td id="T_bdbc2_row0_col2" class="data row0 col2" >13</td>
      <td id="T_bdbc2_row0_col3" class="data row0 col3" >127</td>
      <td id="T_bdbc2_row0_col4" class="data row0 col4" >-3.482920</td>
      <td id="T_bdbc2_row0_col5" class="data row0 col5" >-2.884580</td>
      <td id="T_bdbc2_row0_col6" class="data row0 col6" >-2.579058</td>
      <td id="T_bdbc2_row0_col7" class="data row0 col7" >2720.287960</td>
    </tr>
    <tr>
      <th id="T_bdbc2_level0_row1" class="row_heading level0 row1" >38</th>
      <td id="T_bdbc2_row1_col0" class="data row1 col0" >-2.333016</td>
      <td id="T_bdbc2_row1_col1" class="data row1 col1" >0.161541</td>
      <td id="T_bdbc2_row1_col2" class="data row1 col2" >14</td>
      <td id="T_bdbc2_row1_col3" class="data row1 col3" >126</td>
      <td id="T_bdbc2_row1_col4" class="data row1 col4" >-3.483346</td>
      <td id="T_bdbc2_row1_col5" class="data row1 col5" >-2.884766</td>
      <td id="T_bdbc2_row1_col6" class="data row1 col6" >-2.579156</td>
      <td id="T_bdbc2_row1_col7" class="data row1 col7" >2848.628100</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<section id="id13">
<h5>Observations<a class="headerlink" href="#id13" title="Link to this heading">#</a></h5>
<ul class="simple">
<li><p>Except for stores 33 and 38, all stores have p-value less than 0.05 threshold.</p></li>
<li><p>Similary, except for stores 33 and 38, all stores have ADF statistic value less than 5% critical value.</p></li>
<li><p>These stores are an exception as they don’t follow the general trends and seasonality found in other stores</p></li>
<li><p>So, for rest of the stores, we can confidently reject the null hypothesis and conclude that the storewise sales are stationary.</p></li>
</ul>
</section>
</section>
<section id="kpss-test-for-1st-difference">
<h4>KPSS test for 1st difference<a class="headerlink" href="#kpss-test-for-1st-difference" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_diff1_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_ac9cf td {
  font-size: 12.5px;
}
#T_ac9cf  th {
  font-size: 12.5px;
}
</style>
<table id="T_ac9cf">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_ac9cf_level0_col0" class="col_heading level0 col0" >kpss_stat</th>
      <th id="T_ac9cf_level0_col1" class="col_heading level0 col1" >p_value</th>
      <th id="T_ac9cf_level0_col2" class="col_heading level0 col2" >n_lags</th>
      <th id="T_ac9cf_level0_col3" class="col_heading level0 col3" >crit_10%</th>
      <th id="T_ac9cf_level0_col4" class="col_heading level0 col4" >crit_5%</th>
      <th id="T_ac9cf_level0_col5" class="col_heading level0 col5" >crit_2.5%</th>
      <th id="T_ac9cf_level0_col6" class="col_heading level0 col6" >crit_1%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_ac9cf_level0_row0" class="row_heading level0 row0" >count</th>
      <td id="T_ac9cf_row0_col0" class="data row0 col0" >45.000000</td>
      <td id="T_ac9cf_row0_col1" class="data row0 col1" >45.000000</td>
      <td id="T_ac9cf_row0_col2" class="data row0 col2" >45.000000</td>
      <td id="T_ac9cf_row0_col3" class="data row0 col3" >45.000000</td>
      <td id="T_ac9cf_row0_col4" class="data row0 col4" >45.000000</td>
      <td id="T_ac9cf_row0_col5" class="data row0 col5" >45.000000</td>
      <td id="T_ac9cf_row0_col6" class="data row0 col6" >45.000000</td>
    </tr>
    <tr>
      <th id="T_ac9cf_level0_row1" class="row_heading level0 row1" >mean</th>
      <td id="T_ac9cf_row1_col0" class="data row1 col0" >0.149684</td>
      <td id="T_ac9cf_row1_col1" class="data row1 col1" >0.098210</td>
      <td id="T_ac9cf_row1_col2" class="data row1 col2" >37.577778</td>
      <td id="T_ac9cf_row1_col3" class="data row1 col3" >0.347000</td>
      <td id="T_ac9cf_row1_col4" class="data row1 col4" >0.463000</td>
      <td id="T_ac9cf_row1_col5" class="data row1 col5" >0.574000</td>
      <td id="T_ac9cf_row1_col6" class="data row1 col6" >0.739000</td>
    </tr>
    <tr>
      <th id="T_ac9cf_level0_row2" class="row_heading level0 row2" >std</th>
      <td id="T_ac9cf_row2_col0" class="data row2 col0" >0.082114</td>
      <td id="T_ac9cf_row2_col1" class="data row2 col1" >0.009235</td>
      <td id="T_ac9cf_row2_col2" class="data row2 col2" >23.288203</td>
      <td id="T_ac9cf_row2_col3" class="data row2 col3" >0.000000</td>
      <td id="T_ac9cf_row2_col4" class="data row2 col4" >0.000000</td>
      <td id="T_ac9cf_row2_col5" class="data row2 col5" >0.000000</td>
      <td id="T_ac9cf_row2_col6" class="data row2 col6" >0.000000</td>
    </tr>
    <tr>
      <th id="T_ac9cf_level0_row3" class="row_heading level0 row3" >min</th>
      <td id="T_ac9cf_row3_col0" class="data row3 col0" >0.057553</td>
      <td id="T_ac9cf_row3_col1" class="data row3 col1" >0.041667</td>
      <td id="T_ac9cf_row3_col2" class="data row3 col2" >15.000000</td>
      <td id="T_ac9cf_row3_col3" class="data row3 col3" >0.347000</td>
      <td id="T_ac9cf_row3_col4" class="data row3 col4" >0.463000</td>
      <td id="T_ac9cf_row3_col5" class="data row3 col5" >0.574000</td>
      <td id="T_ac9cf_row3_col6" class="data row3 col6" >0.739000</td>
    </tr>
    <tr>
      <th id="T_ac9cf_level0_row4" class="row_heading level0 row4" >25%</th>
      <td id="T_ac9cf_row4_col0" class="data row4 col0" >0.105590</td>
      <td id="T_ac9cf_row4_col1" class="data row4 col1" >0.100000</td>
      <td id="T_ac9cf_row4_col2" class="data row4 col2" >25.000000</td>
      <td id="T_ac9cf_row4_col3" class="data row4 col3" >0.347000</td>
      <td id="T_ac9cf_row4_col4" class="data row4 col4" >0.463000</td>
      <td id="T_ac9cf_row4_col5" class="data row4 col5" >0.574000</td>
      <td id="T_ac9cf_row4_col6" class="data row4 col6" >0.739000</td>
    </tr>
    <tr>
      <th id="T_ac9cf_level0_row5" class="row_heading level0 row5" >50%</th>
      <td id="T_ac9cf_row5_col0" class="data row5 col0" >0.130501</td>
      <td id="T_ac9cf_row5_col1" class="data row5 col1" >0.100000</td>
      <td id="T_ac9cf_row5_col2" class="data row5 col2" >31.000000</td>
      <td id="T_ac9cf_row5_col3" class="data row5 col3" >0.347000</td>
      <td id="T_ac9cf_row5_col4" class="data row5 col4" >0.463000</td>
      <td id="T_ac9cf_row5_col5" class="data row5 col5" >0.574000</td>
      <td id="T_ac9cf_row5_col6" class="data row5 col6" >0.739000</td>
    </tr>
    <tr>
      <th id="T_ac9cf_level0_row6" class="row_heading level0 row6" >75%</th>
      <td id="T_ac9cf_row6_col0" class="data row6 col0" >0.155536</td>
      <td id="T_ac9cf_row6_col1" class="data row6 col1" >0.100000</td>
      <td id="T_ac9cf_row6_col2" class="data row6 col2" >43.000000</td>
      <td id="T_ac9cf_row6_col3" class="data row6 col3" >0.347000</td>
      <td id="T_ac9cf_row6_col4" class="data row6 col4" >0.463000</td>
      <td id="T_ac9cf_row6_col5" class="data row6 col5" >0.574000</td>
      <td id="T_ac9cf_row6_col6" class="data row6 col6" >0.739000</td>
    </tr>
    <tr>
      <th id="T_ac9cf_level0_row7" class="row_heading level0 row7" >max</th>
      <td id="T_ac9cf_row7_col0" class="data row7 col0" >0.500000</td>
      <td id="T_ac9cf_row7_col1" class="data row7 col1" >0.100000</td>
      <td id="T_ac9cf_row7_col2" class="data row7 col2" >141.000000</td>
      <td id="T_ac9cf_row7_col3" class="data row7 col3" >0.347000</td>
      <td id="T_ac9cf_row7_col4" class="data row7 col4" >0.463000</td>
      <td id="T_ac9cf_row7_col5" class="data row7 col5" >0.574000</td>
      <td id="T_ac9cf_row7_col6" class="data row7 col6" >0.739000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_diff1_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">kpss_diff1_df</span><span class="p">[</span><span class="s1">&#39;p_value&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_465bb td {
  font-size: 12.5px;
}
#T_465bb  th {
  font-size: 12.5px;
}
</style>
<table id="T_465bb">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_465bb_level0_col0" class="col_heading level0 col0" >kpss_stat</th>
      <th id="T_465bb_level0_col1" class="col_heading level0 col1" >p_value</th>
      <th id="T_465bb_level0_col2" class="col_heading level0 col2" >n_lags</th>
      <th id="T_465bb_level0_col3" class="col_heading level0 col3" >crit_10%</th>
      <th id="T_465bb_level0_col4" class="col_heading level0 col4" >crit_5%</th>
      <th id="T_465bb_level0_col5" class="col_heading level0 col5" >crit_2.5%</th>
      <th id="T_465bb_level0_col6" class="col_heading level0 col6" >crit_1%</th>
    </tr>
    <tr>
      <th class="index_name level0" >store</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
      <th class="blank col6" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_465bb_level0_row0" class="row_heading level0 row0" >16</th>
      <td id="T_465bb_row0_col0" class="data row0 col0" >0.500000</td>
      <td id="T_465bb_row0_col1" class="data row0 col1" >0.041667</td>
      <td id="T_465bb_row0_col2" class="data row0 col2" >141</td>
      <td id="T_465bb_row0_col3" class="data row0 col3" >0.347000</td>
      <td id="T_465bb_row0_col4" class="data row0 col4" >0.463000</td>
      <td id="T_465bb_row0_col5" class="data row0 col5" >0.574000</td>
      <td id="T_465bb_row0_col6" class="data row0 col6" >0.739000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_diff1_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">kpss_diff1_df</span><span class="p">[</span><span class="s1">&#39;kpss_stat&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">kpss_diff1_df</span><span class="p">[</span><span class="s1">&#39;crit_5%&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_67963 td {
  font-size: 12.5px;
}
#T_67963  th {
  font-size: 12.5px;
}
</style>
<table id="T_67963">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_67963_level0_col0" class="col_heading level0 col0" >kpss_stat</th>
      <th id="T_67963_level0_col1" class="col_heading level0 col1" >p_value</th>
      <th id="T_67963_level0_col2" class="col_heading level0 col2" >n_lags</th>
      <th id="T_67963_level0_col3" class="col_heading level0 col3" >crit_10%</th>
      <th id="T_67963_level0_col4" class="col_heading level0 col4" >crit_5%</th>
      <th id="T_67963_level0_col5" class="col_heading level0 col5" >crit_2.5%</th>
      <th id="T_67963_level0_col6" class="col_heading level0 col6" >crit_1%</th>
    </tr>
    <tr>
      <th class="index_name level0" >store</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
      <th class="blank col6" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_67963_level0_row0" class="row_heading level0 row0" >16</th>
      <td id="T_67963_row0_col0" class="data row0 col0" >0.500000</td>
      <td id="T_67963_row0_col1" class="data row0 col1" >0.041667</td>
      <td id="T_67963_row0_col2" class="data row0 col2" >141</td>
      <td id="T_67963_row0_col3" class="data row0 col3" >0.347000</td>
      <td id="T_67963_row0_col4" class="data row0 col4" >0.463000</td>
      <td id="T_67963_row0_col5" class="data row0 col5" >0.574000</td>
      <td id="T_67963_row0_col6" class="data row0 col6" >0.739000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<section id="id14">
<h5>Observations<a class="headerlink" href="#id14" title="Link to this heading">#</a></h5>
<ul class="simple">
<li><p>Unlike convention, for KPSS test, failure to reject null hypothesis implies that the series is stationary.</p></li>
<li><p>Except for store 16, all stores have p-value more than 0.05 threshold.</p></li>
<li><p>Similary, except for store16, all stores have ADF statistic value more than 5% critical value.</p></li>
<li><p>This store is an exception as it doesn’t follow the general trends and seasonality found in other stores</p></li>
<li><p>So, for rest of the stores, we can don’t have enough evidence to reject the null hypothesis and conclude that the storewise sales are stationary.</p></li>
</ul>
</section>
</section>
<section id="kpss-test-for-2nd-difference">
<h4>KPSS test for 2nd difference<a class="headerlink" href="#kpss-test-for-2nd-difference" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_diff2_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_69fd4 td {
  font-size: 12.5px;
}
#T_69fd4  th {
  font-size: 12.5px;
}
</style>
<table id="T_69fd4">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_69fd4_level0_col0" class="col_heading level0 col0" >kpss_stat</th>
      <th id="T_69fd4_level0_col1" class="col_heading level0 col1" >p_value</th>
      <th id="T_69fd4_level0_col2" class="col_heading level0 col2" >n_lags</th>
      <th id="T_69fd4_level0_col3" class="col_heading level0 col3" >crit_10%</th>
      <th id="T_69fd4_level0_col4" class="col_heading level0 col4" >crit_5%</th>
      <th id="T_69fd4_level0_col5" class="col_heading level0 col5" >crit_2.5%</th>
      <th id="T_69fd4_level0_col6" class="col_heading level0 col6" >crit_1%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_69fd4_level0_row0" class="row_heading level0 row0" >count</th>
      <td id="T_69fd4_row0_col0" class="data row0 col0" >45.000000</td>
      <td id="T_69fd4_row0_col1" class="data row0 col1" >45.000000</td>
      <td id="T_69fd4_row0_col2" class="data row0 col2" >45.000000</td>
      <td id="T_69fd4_row0_col3" class="data row0 col3" >45.000000</td>
      <td id="T_69fd4_row0_col4" class="data row0 col4" >45.000000</td>
      <td id="T_69fd4_row0_col5" class="data row0 col5" >45.000000</td>
      <td id="T_69fd4_row0_col6" class="data row0 col6" >45.000000</td>
    </tr>
    <tr>
      <th id="T_69fd4_level0_row1" class="row_heading level0 row1" >mean</th>
      <td id="T_69fd4_row1_col0" class="data row1 col0" >0.088154</td>
      <td id="T_69fd4_row1_col1" class="data row1 col1" >0.098704</td>
      <td id="T_69fd4_row1_col2" class="data row1 col2" >20.377778</td>
      <td id="T_69fd4_row1_col3" class="data row1 col3" >0.347000</td>
      <td id="T_69fd4_row1_col4" class="data row1 col4" >0.463000</td>
      <td id="T_69fd4_row1_col5" class="data row1 col5" >0.574000</td>
      <td id="T_69fd4_row1_col6" class="data row1 col6" >0.739000</td>
    </tr>
    <tr>
      <th id="T_69fd4_level0_row2" class="row_heading level0 row2" >std</th>
      <td id="T_69fd4_row2_col0" class="data row2 col0" >0.088579</td>
      <td id="T_69fd4_row2_col1" class="data row2 col1" >0.008696</td>
      <td id="T_69fd4_row2_col2" class="data row2 col2" >23.698186</td>
      <td id="T_69fd4_row2_col3" class="data row2 col3" >0.000000</td>
      <td id="T_69fd4_row2_col4" class="data row2 col4" >0.000000</td>
      <td id="T_69fd4_row2_col5" class="data row2 col5" >0.000000</td>
      <td id="T_69fd4_row2_col6" class="data row2 col6" >0.000000</td>
    </tr>
    <tr>
      <th id="T_69fd4_level0_row3" class="row_heading level0 row3" >min</th>
      <td id="T_69fd4_row3_col0" class="data row3 col0" >0.015239</td>
      <td id="T_69fd4_row3_col1" class="data row3 col1" >0.041667</td>
      <td id="T_69fd4_row3_col2" class="data row3 col2" >4.000000</td>
      <td id="T_69fd4_row3_col3" class="data row3 col3" >0.347000</td>
      <td id="T_69fd4_row3_col4" class="data row3 col4" >0.463000</td>
      <td id="T_69fd4_row3_col5" class="data row3 col5" >0.574000</td>
      <td id="T_69fd4_row3_col6" class="data row3 col6" >0.739000</td>
    </tr>
    <tr>
      <th id="T_69fd4_level0_row4" class="row_heading level0 row4" >25%</th>
      <td id="T_69fd4_row4_col0" class="data row4 col0" >0.040464</td>
      <td id="T_69fd4_row4_col1" class="data row4 col1" >0.100000</td>
      <td id="T_69fd4_row4_col2" class="data row4 col2" >11.000000</td>
      <td id="T_69fd4_row4_col3" class="data row4 col3" >0.347000</td>
      <td id="T_69fd4_row4_col4" class="data row4 col4" >0.463000</td>
      <td id="T_69fd4_row4_col5" class="data row4 col5" >0.574000</td>
      <td id="T_69fd4_row4_col6" class="data row4 col6" >0.739000</td>
    </tr>
    <tr>
      <th id="T_69fd4_level0_row5" class="row_heading level0 row5" >50%</th>
      <td id="T_69fd4_row5_col0" class="data row5 col0" >0.065140</td>
      <td id="T_69fd4_row5_col1" class="data row5 col1" >0.100000</td>
      <td id="T_69fd4_row5_col2" class="data row5 col2" >15.000000</td>
      <td id="T_69fd4_row5_col3" class="data row5 col3" >0.347000</td>
      <td id="T_69fd4_row5_col4" class="data row5 col4" >0.463000</td>
      <td id="T_69fd4_row5_col5" class="data row5 col5" >0.574000</td>
      <td id="T_69fd4_row5_col6" class="data row5 col6" >0.739000</td>
    </tr>
    <tr>
      <th id="T_69fd4_level0_row6" class="row_heading level0 row6" >75%</th>
      <td id="T_69fd4_row6_col0" class="data row6 col0" >0.095313</td>
      <td id="T_69fd4_row6_col1" class="data row6 col1" >0.100000</td>
      <td id="T_69fd4_row6_col2" class="data row6 col2" >19.000000</td>
      <td id="T_69fd4_row6_col3" class="data row6 col3" >0.347000</td>
      <td id="T_69fd4_row6_col4" class="data row6 col4" >0.463000</td>
      <td id="T_69fd4_row6_col5" class="data row6 col5" >0.574000</td>
      <td id="T_69fd4_row6_col6" class="data row6 col6" >0.739000</td>
    </tr>
    <tr>
      <th id="T_69fd4_level0_row7" class="row_heading level0 row7" >max</th>
      <td id="T_69fd4_row7_col0" class="data row7 col0" >0.500000</td>
      <td id="T_69fd4_row7_col1" class="data row7 col1" >0.100000</td>
      <td id="T_69fd4_row7_col2" class="data row7 col2" >140.000000</td>
      <td id="T_69fd4_row7_col3" class="data row7 col3" >0.347000</td>
      <td id="T_69fd4_row7_col4" class="data row7 col4" >0.463000</td>
      <td id="T_69fd4_row7_col5" class="data row7 col5" >0.574000</td>
      <td id="T_69fd4_row7_col6" class="data row7 col6" >0.739000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_diff1_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">kpss_diff1_df</span><span class="p">[</span><span class="s1">&#39;p_value&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_f41a3 td {
  font-size: 12.5px;
}
#T_f41a3  th {
  font-size: 12.5px;
}
</style>
<table id="T_f41a3">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_f41a3_level0_col0" class="col_heading level0 col0" >kpss_stat</th>
      <th id="T_f41a3_level0_col1" class="col_heading level0 col1" >p_value</th>
      <th id="T_f41a3_level0_col2" class="col_heading level0 col2" >n_lags</th>
      <th id="T_f41a3_level0_col3" class="col_heading level0 col3" >crit_10%</th>
      <th id="T_f41a3_level0_col4" class="col_heading level0 col4" >crit_5%</th>
      <th id="T_f41a3_level0_col5" class="col_heading level0 col5" >crit_2.5%</th>
      <th id="T_f41a3_level0_col6" class="col_heading level0 col6" >crit_1%</th>
    </tr>
    <tr>
      <th class="index_name level0" >store</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
      <th class="blank col6" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_f41a3_level0_row0" class="row_heading level0 row0" >16</th>
      <td id="T_f41a3_row0_col0" class="data row0 col0" >0.500000</td>
      <td id="T_f41a3_row0_col1" class="data row0 col1" >0.041667</td>
      <td id="T_f41a3_row0_col2" class="data row0 col2" >141</td>
      <td id="T_f41a3_row0_col3" class="data row0 col3" >0.347000</td>
      <td id="T_f41a3_row0_col4" class="data row0 col4" >0.463000</td>
      <td id="T_f41a3_row0_col5" class="data row0 col5" >0.574000</td>
      <td id="T_f41a3_row0_col6" class="data row0 col6" >0.739000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_diff1_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">kpss_diff1_df</span><span class="p">[</span><span class="s1">&#39;kpss_stat&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">kpss_diff1_df</span><span class="p">[</span><span class="s1">&#39;crit_5%&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_69b90 td {
  font-size: 12.5px;
}
#T_69b90  th {
  font-size: 12.5px;
}
</style>
<table id="T_69b90">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_69b90_level0_col0" class="col_heading level0 col0" >kpss_stat</th>
      <th id="T_69b90_level0_col1" class="col_heading level0 col1" >p_value</th>
      <th id="T_69b90_level0_col2" class="col_heading level0 col2" >n_lags</th>
      <th id="T_69b90_level0_col3" class="col_heading level0 col3" >crit_10%</th>
      <th id="T_69b90_level0_col4" class="col_heading level0 col4" >crit_5%</th>
      <th id="T_69b90_level0_col5" class="col_heading level0 col5" >crit_2.5%</th>
      <th id="T_69b90_level0_col6" class="col_heading level0 col6" >crit_1%</th>
    </tr>
    <tr>
      <th class="index_name level0" >store</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
      <th class="blank col6" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_69b90_level0_row0" class="row_heading level0 row0" >16</th>
      <td id="T_69b90_row0_col0" class="data row0 col0" >0.500000</td>
      <td id="T_69b90_row0_col1" class="data row0 col1" >0.041667</td>
      <td id="T_69b90_row0_col2" class="data row0 col2" >141</td>
      <td id="T_69b90_row0_col3" class="data row0 col3" >0.347000</td>
      <td id="T_69b90_row0_col4" class="data row0 col4" >0.463000</td>
      <td id="T_69b90_row0_col5" class="data row0 col5" >0.574000</td>
      <td id="T_69b90_row0_col6" class="data row0 col6" >0.739000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<section id="id15">
<h5>Observations<a class="headerlink" href="#id15" title="Link to this heading">#</a></h5>
<ul class="simple">
<li><p>The results for 2nd difference are same as those for 1st difference.</p></li>
<li><p>Except for store 16, all stores have p-value more than 0.05 threshold.</p></li>
<li><p>Similary, except for store16, all stores have ADF statistic value more than 5% critical value.</p></li>
<li><p>This store is an exception as it doesn’t follow the general trends and seasonality found in other stores</p></li>
<li><p>So, for rest of the stores, we can don’t have enough evidence to reject the null hypothesis and conclude that the storewise sales are stationary.</p></li>
</ul>
</section>
</section>
</section>
</section>
<section id="auto-correlation-and-partial-autocorrelation">
<h2>Auto-correlation and Partial Autocorrelation<a class="headerlink" href="#auto-correlation-and-partial-autocorrelation" title="Link to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span>
<span class="n">store_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">store</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Set the &#39;date&#39; column as the index for easier time series manipulation.</span>
<span class="n">store_df</span> <span class="o">=</span> <span class="n">store_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="n">sales</span> <span class="o">=</span> <span class="n">store_df</span><span class="p">[</span><span class="s1">&#39;weekly_sales&#39;</span><span class="p">]</span>

<span class="c1"># Create a dictionary to store our differenced series.</span>
<span class="n">series_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># 1. Original series (no differencing)</span>
<span class="n">series_dict</span><span class="p">[</span><span class="s1">&#39;original&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sales</span>

<span class="c1"># 2. 1 week regular differenced series (first difference)</span>
<span class="n">series_dict</span><span class="p">[</span><span class="s1">&#39;diff_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sales</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># 3. 2 times regular differenced series (second difference)</span>
<span class="n">series_dict</span><span class="p">[</span><span class="s1">&#39;diff_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sales</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># 4. 3 times regular differenced series (third difference)</span>
<span class="n">series_dict</span><span class="p">[</span><span class="s1">&#39;diff_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sales</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># 5. 52-week seasonal differenced series.</span>
<span class="n">series_dict</span><span class="p">[</span><span class="s1">&#39;seasonsal_diff_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sales</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="mi">52</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>


<span class="c1"># Function to plot ACF and PACF for each series,</span>
<span class="c1"># adjusting the y-axis limits based on computed values,</span>
<span class="c1"># and enabling grid.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_differenced_series</span><span class="p">(</span><span class="n">series_dict</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">series</span> <span class="ow">in</span> <span class="n">series_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ACF &amp; PACF for </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> for store </span><span class="si">{</span><span class="n">store</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plotting ACF &amp; PACF for </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Compute ACF values (skip lag 0)</span>
        <span class="n">acf_vals</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">acf</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="n">lags</span><span class="p">,</span> <span class="n">fft</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Exclude the zero-lag (which is always 1) for axis range computation.</span>
        <span class="n">nonzero_acf</span> <span class="o">=</span> <span class="n">acf_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1"># Compute a margin (5% of the absolute values)</span>
        <span class="n">margin_acf</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">nonzero_acf</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nonzero_acf</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
        <span class="n">ymin_acf</span> <span class="o">=</span> <span class="n">nonzero_acf</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">margin_acf</span>
        <span class="n">ymax_acf</span> <span class="o">=</span> <span class="n">nonzero_acf</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">margin_acf</span>
        
        <span class="c1"># Plot ACF with grid enabled.</span>
        <span class="n">plot_acf</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="n">lags</span><span class="p">,</span> <span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ACF - </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> for store </span><span class="si">{</span><span class="n">store</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin_acf</span><span class="p">,</span> <span class="n">ymax_acf</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Compute PACF values (skip lag 0)</span>
        <span class="n">pacf_vals</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">pacf</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="n">lags</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ywm&#39;</span><span class="p">)</span>
        <span class="n">nonzero_pacf</span> <span class="o">=</span> <span class="n">pacf_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">margin_pacf</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">nonzero_pacf</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nonzero_pacf</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
        <span class="n">ymin_pacf</span> <span class="o">=</span> <span class="n">nonzero_pacf</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">margin_pacf</span>
        <span class="n">ymax_pacf</span> <span class="o">=</span> <span class="n">nonzero_pacf</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">margin_pacf</span>
        
        <span class="c1"># Plot PACF with grid enabled.</span>
        <span class="n">plot_pacf</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="n">lags</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ywm&#39;</span><span class="p">,</span> <span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PACF - </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> for store </span><span class="si">{</span><span class="n">store</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin_pacf</span><span class="p">,</span> <span class="n">ymax_pacf</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Plot ACF and PACF for all our series.</span>
<span class="n">plot_differenced_series</span><span class="p">(</span><span class="n">series_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting ACF &amp; PACF for original
</pre></div>
</div>
<img alt="../_images/3ea0b48c7726af5c571c68418993b8c3ecd68abe4aada432e4fbe0268aef28d1.png" src="../_images/3ea0b48c7726af5c571c68418993b8c3ecd68abe4aada432e4fbe0268aef28d1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting ACF &amp; PACF for diff_1
</pre></div>
</div>
<img alt="../_images/ddfc236d2a11e59b54a516f4fb4ab149dfac0a869dd8daba45a78deaa1e77115.png" src="../_images/ddfc236d2a11e59b54a516f4fb4ab149dfac0a869dd8daba45a78deaa1e77115.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting ACF &amp; PACF for diff_2
</pre></div>
</div>
<img alt="../_images/71112a4f8ac92b3efe41c9b9cb4e79d03beafbaa88d854acba9d3c576f1165f5.png" src="../_images/71112a4f8ac92b3efe41c9b9cb4e79d03beafbaa88d854acba9d3c576f1165f5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting ACF &amp; PACF for diff_3
</pre></div>
</div>
<img alt="../_images/3054ce6403c7f5a102720a98e305d7cf5b89407a50c4548ec54073a7ca29f14e.png" src="../_images/3054ce6403c7f5a102720a98e305d7cf5b89407a50c4548ec54073a7ca29f14e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting ACF &amp; PACF for seasonsal_diff_1
</pre></div>
</div>
<img alt="../_images/7dd608de4a172de4e397c4653bc7ef915227032bd02ab9129de58fa6ba421a8b.png" src="../_images/7dd608de4a172de4e397c4653bc7ef915227032bd02ab9129de58fa6ba421a8b.png" />
</div>
</div>
<section id="id16">
<h3>Observations<a class="headerlink" href="#id16" title="Link to this heading">#</a></h3>
<p>From visual inspection of ACF and PACF plots for regular, 1st and 2nd order differenced sales, a few candidates for AR and MA orders are identified.</p>
<ul class="simple">
<li><p>ARIMA candidates</p>
<ul>
<li><p>Difference 1 (d = 1)</p>
<ul>
<li><p>AR orders (PACF) [6]</p></li>
<li><p>MA orders (ACF) [4, 5]</p></li>
</ul>
</li>
<li><p>Difference 2 (d = 2)</p>
<ul>
<li><p>AR orders (PACF) [6, 9]</p></li>
<li><p>MA orders (ACF) [4, 5]</p></li>
</ul>
</li>
</ul>
</li>
<li><p>SARIMA candidates</p>
<ul>
<li><p>Seasonal Difference 1 (D = 1)</p>
<ul>
<li><p>AR orders (PACF) [3]</p></li>
<li><p>MA orders (ACF) [5]</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>From these candidates, these ARIMA and SARIMA models are selected:</p>
<ul class="simple">
<li><p>ARIMA</p>
<ul>
<li><p>(6, 1, 4)</p></li>
<li><p>(6, 1, 5)</p></li>
<li><p>(6, 2, 4)</p></li>
<li><p>(6, 2, 5)</p></li>
<li><p>(9, 2, 4)</p></li>
<li><p>(9, 2, 5)</p></li>
</ul>
</li>
<li><p>SARIMA</p>
<ul>
<li><p>(6, 1, 4), (2, 1, 5, 52)</p></li>
<li><p>(6, 1, 5), (2, 1, 5, 52)</p></li>
<li><p>(6, 2, 4), (2, 1, 5, 52)</p></li>
<li><p>(6, 2, 5), (2, 1, 5, 52)</p></li>
<li><p>(9, 2, 4), (2, 1, 5, 52)</p></li>
<li><p>(9, 2, 5), (2, 1, 5, 52)</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="extra-eda-to-do">
<h2>Extra EDA To Do<a class="headerlink" href="#extra-eda-to-do" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Holiday Flags:</p>
<ul class="simple">
<li><p>Check for sales 2 weeks before and after holiday flags.</p></li>
<li><p>Do all holiday flags give boost to sales?</p></li>
<li><p>Quantify which flags are driving most and least sales.</p></li>
<li><p>Does a particular holiday flag have a stronger effect on sales of few stores than others? check relative sales growth in +- 2 weeks of that holiday for all stores. Do this for all holiday flags and also other dates that drive sales but aren’t marked as holiday flags</p></li>
<li><p>Use Darts libary’s anamoly detector to extract actual ‘holidays’ events that boost sales.</p></li>
</ul>
</li>
<li><p>Seasonal Trends:</p>
<ul class="simple">
<li><p>Check if you can smooth out the seasons even more (since we only have ~3 years of data, catching seasonal patterns might be hard. Also, they are more of yearly repeating irregularities like holidays more than seasonal patterns). Try out different methods like FFT, or specific decomposition, anamoly detection, etc.</p></li>
</ul>
</li>
<li><p>Use hypothesis testing to validate linear correlation between:</p>
<ul class="simple">
<li><p>weekly sales and cpi</p></li>
<li><p>cpi, unemployment and fuel price</p></li>
</ul>
</li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./main"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../summary/summary.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Results and Conclusions</p>
      </div>
    </a>
    <a class="right-next"
       href="forecasting.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Forecasting</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-libraries-and-dataset">Importing Libraries and Dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preliminary-data-cleaning">Preliminary Data Cleaning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-major-observations">Final/Major Observations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-if-features-vary-only-with-date-or-store-too">Checking if features vary only with date or store too</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cpi">CPI</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature">Temperature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#holidays">Holidays</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions-observations">Conclusions/observations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#univariate-and-bivariate-analysis-using-ydata-profiling">Univariate and Bivariate Analysis using Ydata Profiling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#miscellaneous-analysis">Miscellaneous Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-sales-with-respect-to-date-and-holidays">Checking sales with respect to date and holidays</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#observations">Observations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#store-wise-aggregate-metrics">Store wise Aggregate metrics</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unemployment-rate-analysis">Unemployment Rate Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sales-and-unemployment-comparison">Sales and Unemployment comparison</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#correlation-between-unemployment-rate-and-sales">Correlation between unemployment rate and sales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decomposition-of-store-wise-weekly-sales">Decomposition of Store-wise Weekly Sales</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stl-decomposition-of-weekly-sales-for-selected-stores">STL Decomposition of weekly_sales for selected stores</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mstl-to-capture-monthly-and-annual-seasonality-separately">MSTL to capture monthly and annual seasonality separately?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature-effect">Temperature Effect</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-correlation-between-weekly-sales-and-temperature">Checking correlation between weekly_sales and temperature</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Observations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonal-decomposition-of-temperature">Seasonal Decomposition of Temperature</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Observations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consumer-price-index">Consumer Price Index</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-correlation-between-weekly-sales-and-its-trend-component-with-cpi">Checking correlation between weekly_sales and its trend component with CPI</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fuel-price">Fuel Price</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-correlation-between-weekly-sales-and-its-trend-component-with-fuel-price">Checking correlation between weekly_sales and its trend component with Fuel Price</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Store Performance Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-all-metrics-and-corresponding-store-ranks">Calculating all metrics and corresponding store ranks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#average-weekly-sales">Average Weekly Sales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#percentage-growth-in-sales">Percentage Growth in Sales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-growth-in-terms-of-trend-of-weekly-sales">Linear growth in terms of Trend of Weekly Sales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#volatility-of-sales">Volatility of Sales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#composite-metric">Composite Metric</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">Conclusions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-correlation-between-unemployment-fuel-price-and-cpi">Checking correlation between unemployment, fuel_price and cpi</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pca-with-cpi-fuel-price-and-unemployment">PCA with CPI, Fuel Price, and Unemployment</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why">Why?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-observations">Conclusion/Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stationarity">Stationarity</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transformations">Transformations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Observations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonal-decomposition-of-differences">Seasonal Decomposition of Differences</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Observations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonal-differencing">Seasonal Differencing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Observations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adf-and-kpss-test-for-stationarity">ADF and KPSS test for stationarity</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adf-for-1st-order-differences">ADF for 1st order differences</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Observations</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adf-for-2nd-order-differences">ADF for 2nd order differences</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Observations</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#kpss-test-for-1st-difference">KPSS test for 1st difference</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">Observations</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#kpss-test-for-2nd-difference">KPSS test for 2nd difference</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">Observations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#auto-correlation-and-partial-autocorrelation">Auto-correlation and Partial Autocorrelation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-eda-to-do">Extra EDA To Do</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Aditya Joshi [www.adityajoshi.in]
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>